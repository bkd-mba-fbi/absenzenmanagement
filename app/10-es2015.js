(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{pXY1:function(e,t,n){"use strict";n.r(t),n.d(t,"EditAbsencesModule",(function(){return Ye}));var s=n("PCNd"),c=n("tyNb"),i=n("itXk"),a=n("UXun"),r=n("lJxs"),o=n("1G5W"),b=n("v6cN"),l=n("CCnw"),d=n("CqUA"),u=n("KJh6"),f=n("FJ3f"),p=n("eB9A"),h=n("NPit"),m=n("fhBx"),g=n("Xr/R"),y=n("RYjX");function v(e,t,n){return e.map(e=>{let s,c=null;return e.TypeRef.Id&&(c=t.find(t=>t.Id===e.TypeRef.Id)||null),e.ConfirmationStateId&&(s=n.find(t=>t.Key===e.ConfirmationStateId)),new y.b(e,c,s)})}var O=n("fXoL"),P=n("ofXK");let x=(()=>{class e extends m.b{constructor(e,t,n,s,c,b){super(e,t,n,"/edit-absences"),this.lessonPresencesService=s,this.presenceTypesService=c,this.dropDownItemsService=b,this.presenceTypes$=this.loadPresenceTypes().pipe(Object(a.a)(1)),this.absenceConfirmationStates$=this.loadAbsenceConfirmationStates().pipe(Object(r.a)(f.b),Object(a.a)(1)),this.presenceControlEntries$=Object(i.a)([this.entries$,this.presenceTypes$,this.absenceConfirmationStates$]).pipe(Object(r.a)(Object(p.a)(v)),Object(a.a)(1)),this.selected=[],this.queryParamsString$.pipe(Object(o.a)(this.destroy$)).subscribe(e=>this.confirmBackLinkParams={returnparams:e})}resetSelection(){this.selected=[]}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceType:null,confirmationState:null,incidentType:null}}isValidFilter(e){return Boolean(e.student||e.educationalEvent||e.studyClass||e.dateFrom||e.dateTo||e.presenceType||e.confirmationState||e.incidentType)}loadEntries(e,t,n){return this.loadingService.load(this.lessonPresencesService.getFilteredList(e,n,{sort:"StudentFullName.asc,LessonDateTimeFrom.asc"}),m.a)}buildParamsFromFilter(e){return Object(h.a)(e)}loadPresenceTypes(){return this.loadingService.load(this.presenceTypesService.activePresenceTypes$)}loadAbsenceConfirmationStates(){return this.loadingService.load(this.dropDownItemsService.getAbsenceConfirmationStates())}}return e.\u0275fac=function(t){return new(t||e)(O.Xb(P.i),O.Xb(d.a),O.Xb(g.a),O.Xb(l.a),O.Xb(u.a),O.Xb(b.a))},e.\u0275prov=O.Gb({token:e,factory:e.\u0275fac}),e})();var C=n("qUtt");let j=(()=>{class e{constructor(e){this.state=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(O.Kb(x))},e.\u0275cmp=O.Eb({type:e,selectors:[["erz-edit-absences"]],features:[O.wb([x,{provide:C.a,useExisting:x}])],decls:1,vars:0,template:function(e,t){1&e&&O.Lb(0,"router-outlet")},directives:[c.i],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),e})();var I=n("XNiG"),S=n("IzEk"),$=n("wO+i"),E=n("pLZG"),T=n("ulei");let k=(()=>{class e extends T.a{}return e.\u0275fac=function(t){return F(t||e)},e.\u0275prov=O.Gb({token:e,factory:e.\u0275fac}),e})();const F=O.Rb(k);var w=n("yl8S"),G=n("KCaQ"),D=n("K+0v"),A=n("EOpz"),z=n("1kSV"),L=n("M34a"),K=n("vlqf"),q=n("YDIV"),M=n("PAVU"),V=n("vjgy"),R=n("mmcK"),N=n("4vbw"),B=n("jSy9"),_=n("DKSB"),X=n("wnGv"),H=n("sYmb");let Q=(()=>{class e{constructor(e,t,n,s){this.studentsService=e,this.educationalEventsService=t,this.studyClassService=n,this.state=s,this.filter={student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceType:null,confirmationState:null,incidentType:null},this.filterChange=new O.n,this.absenceConfirmationStates$=this.state.absenceConfirmationStates$,this.presenceTypes$=this.state.presenceTypes$.pipe(Object(r.a)(e=>e.filter(Object(D.d)(K.d)).filter(Object(D.d)(K.f))),Object(r.a)(M.a)),this.incidentTypes$=this.state.presenceTypes$.pipe(Object(r.a)(e=>e.filter(K.f)),Object(r.a)(M.a))}ngOnInit(){}show(){this.filterChange.emit(Object.assign(Object.assign({},this.filter),{dateFrom:J(this.filter.dateFrom),dateTo:J(this.filter.dateTo)}))}}return e.\u0275fac=function(t){return new(t||e)(O.Kb(R.a),O.Kb(V.a),O.Kb(N.a),O.Kb(x))},e.\u0275cmp=O.Eb({type:e,selectors:[["erz-edit-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[O.wb([{provide:z.c,useClass:z.d},{provide:z.e,useClass:q.a}])],decls:49,vars:47,consts:[[1,"filters","mb-2"],[1,"form-group"],[3,"typeaheadService","value","valueChange"],[3,"value","valueChange"],[1,"filters","mt-2"],[3,"options","value","valueChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(O.Pb(0,"div",0),O.Pb(1,"div",1),O.Pb(2,"label"),O.Ec(3),O.ec(4,"translate"),O.Ob(),O.Pb(5,"erz-typeahead",2),O.bc("valueChange",(function(e){return t.filter.student=e})),O.Ob(),O.Ob(),O.Pb(6,"div",1),O.Pb(7,"label"),O.Ec(8),O.ec(9,"translate"),O.Ob(),O.Pb(10,"erz-typeahead",2),O.bc("valueChange",(function(e){return t.filter.educationalEvent=e})),O.Ob(),O.Ob(),O.Pb(11,"div",1),O.Pb(12,"label"),O.Ec(13),O.ec(14,"translate"),O.Ob(),O.Pb(15,"erz-typeahead",2),O.bc("valueChange",(function(e){return t.filter.studyClass=e})),O.Ob(),O.Ob(),O.Pb(16,"div",1),O.Pb(17,"label"),O.Ec(18),O.ec(19,"translate"),O.Ob(),O.Pb(20,"erz-date-select",3),O.bc("valueChange",(function(e){return t.filter.dateFrom=e})),O.Ob(),O.Ob(),O.Pb(21,"div",1),O.Pb(22,"label"),O.Ec(23),O.ec(24,"translate"),O.Ob(),O.Pb(25,"erz-date-select",3),O.bc("valueChange",(function(e){return t.filter.dateTo=e})),O.Ob(),O.Ob(),O.Ob(),O.Pb(26,"div",4),O.Pb(27,"div",1),O.Pb(28,"label"),O.Ec(29),O.ec(30,"translate"),O.Ob(),O.Pb(31,"erz-select",5),O.bc("valueChange",(function(e){return t.filter.confirmationState=e})),O.ec(32,"async"),O.Ob(),O.Ob(),O.Pb(33,"div",1),O.Pb(34,"label"),O.Ec(35),O.ec(36,"translate"),O.Ob(),O.Pb(37,"erz-select",5),O.bc("valueChange",(function(e){return t.filter.presenceType=e})),O.ec(38,"async"),O.Ob(),O.Ob(),O.Pb(39,"div",1),O.Pb(40,"label"),O.Ec(41),O.ec(42,"translate"),O.Ob(),O.Pb(43,"erz-select",5),O.bc("valueChange",(function(e){return t.filter.incidentType=e})),O.ec(44,"async"),O.Ob(),O.Ob(),O.Pb(45,"div",6),O.Pb(46,"button",7),O.bc("click",(function(){return t.show()})),O.Ec(47),O.ec(48,"translate"),O.Ob(),O.Ob(),O.Ob()),2&e&&(O.xb(3),O.Fc(O.fc(4,23,"edit-absences.header.student")),O.xb(2),O.jc("typeaheadService",t.studentsService)("value",t.filter.student),O.xb(3),O.Fc(O.fc(9,25,"edit-absences.header.module-instance")),O.xb(2),O.jc("typeaheadService",t.educationalEventsService)("value",t.filter.educationalEvent),O.xb(3),O.Fc(O.fc(14,27,"edit-absences.header.study-class")),O.xb(2),O.jc("typeaheadService",t.studyClassService)("value",t.filter.studyClass),O.xb(3),O.Fc(O.fc(19,29,"edit-absences.header.date-from")),O.xb(2),O.jc("value",t.filter.dateFrom),O.xb(3),O.Fc(O.fc(24,31,"edit-absences.header.date-to")),O.xb(2),O.jc("value",t.filter.dateTo),O.xb(4),O.Fc(O.fc(30,33,"edit-absences.header.confirmation-state")),O.xb(2),O.jc("options",O.fc(32,35,t.absenceConfirmationStates$))("value",t.filter.confirmationState),O.xb(4),O.Fc(O.fc(36,37,"edit-absences.header.presence-type")),O.xb(2),O.jc("options",O.fc(38,39,t.presenceTypes$))("value",t.filter.presenceType),O.xb(4),O.Fc(O.fc(42,41,"edit-absences.header.incident")),O.xb(2),O.jc("options",O.fc(44,43,t.incidentTypes$))("value",t.filter.incidentType),O.xb(4),O.Gc(" ",O.fc(48,45,"edit-absences.header.show")," "))},directives:[B.a,_.a,X.a],pipes:[H.c,P.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.5rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width:767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),e})();function J(e){return e?Object(L.a)(e):null}var Y=n("dlKe"),U=n("4Kj8");const W=function(e){return{count:e}},Z=function(e){return{returnparams:e}};function ee(e,t){if(1&e&&(O.Pb(0,"div",12),O.Pb(1,"div",13),O.Ec(2),O.ec(3,"translate"),O.ec(4,"async"),O.ec(5,"translate"),O.Ob(),O.Pb(6,"a",14),O.ec(7,"async"),O.Pb(8,"i",15),O.Ec(9,"edit"),O.Ob(),O.Ob(),O.Ob()),2&e){const e=O.dc(4).erzLet,t=O.dc();O.xb(2),O.Hc(" ",O.gc(3,5,"edit-absences.list.total",O.nc(15,W,O.fc(4,8,t.state.total$)||0)),", ",O.gc(5,10,"edit-absences.list.selected",O.nc(17,W,e.selection.length))," "),O.xb(4),O.Cb("disabled",0===e.selection.length),O.jc("queryParams",O.nc(19,Z,O.fc(7,13,t.state.queryParamsString$)))}}const te=function(e){return["student",e]};function ne(e,t){if(1&e){const e=O.Qb();O.Pb(0,"tr"),O.Pb(1,"td",20),O.bc("click",(function(t){O.uc(e);const n=O.tc(3);return O.dc(6).onCheckboxCellClick(t,n)})),O.Pb(2,"input",17,21),O.bc("change",(function(){O.uc(e);const n=t.$implicit;return O.dc(6).selectionService.toggle(n.lessonPresence)})),O.ec(4,"async"),O.Ob(),O.Ob(),O.Pb(5,"td",18),O.ec(6,"translate"),O.Pb(7,"span",22),O.Pb(8,"i",15),O.Ec(9),O.Ob(),O.Ob(),O.Ob(),O.Pb(10,"td"),O.ec(11,"translate"),O.Pb(12,"a",23),O.ec(13,"async"),O.Ec(14),O.Ob(),O.Lb(15,"br"),O.Ec(16),O.Ob(),O.Pb(17,"td"),O.ec(18,"translate"),O.Ec(19),O.ec(20,"date"),O.Ob(),O.Pb(21,"td"),O.ec(22,"translate"),O.Ec(23),O.ec(24,"date"),O.ec(25,"date"),O.Ob(),O.Pb(26,"td"),O.ec(27,"translate"),O.Ec(28),O.Ob(),O.Pb(29,"td",24),O.ec(30,"translate"),O.Ec(31),O.Ob(),O.Pb(32,"td"),O.ec(33,"translate"),O.Ec(34),O.Ob(),O.Ob()}if(2&e){const e=t.$implicit,n=O.dc(6);O.xb(2),O.jc("checked",O.fc(4,21,n.selectionService.isSelected$(e.lessonPresence))),O.xb(3),O.yb("data-label",O.fc(6,23,"edit-absences.list.header.presence")),O.xb(2),O.jc("className",e.presenceCategory),O.xb(2),O.Fc(e.presenceCategoryIcon),O.xb(1),O.yb("data-label",O.fc(11,25,"edit-absences.list.header.mobil-student-module-instance-study-class")),O.xb(2),O.jc("routerLink",O.nc(48,te,e.lessonPresence.StudentRef.Id))("queryParams",O.nc(50,Z,O.fc(13,27,n.profileReturnParams$))),O.xb(2),O.Gc(" ",e.lessonPresence.StudentFullName," "),O.xb(2),O.Hc(" ",e.lessonPresence.EventDesignation,", ",e.lessonPresence.StudyClassNumber," "),O.xb(1),O.yb("data-label",O.fc(18,29,"edit-absences.list.header.date")),O.xb(2),O.Gc(" ",O.gc(20,31,e.lessonPresence.LessonDateTimeFrom,"mediumDate")," "),O.xb(2),O.yb("data-label",O.fc(22,34,"edit-absences.list.header.time")),O.xb(2),O.Hc(" ",O.gc(24,36,e.lessonPresence.LessonDateTimeFrom,"shortTime"),"\u2013",O.gc(25,39,e.lessonPresence.LessonDateTimeTo,"shortTime")," "),O.xb(3),O.yb("data-label",O.fc(27,42,"edit-absences.list.header.confirmation-state")),O.xb(2),O.Gc(" ",null==e.confirmationState?null:e.confirmationState.Value," "),O.xb(1),O.yb("data-label",O.fc(30,44,"edit-absences.list.header.mobil-presence-type-incident")),O.xb(2),O.Gc(" ",null==e.presenceType?null:e.presenceType.Designation," "),O.xb(1),O.yb("data-label",O.fc(33,46,"edit-absences.list.header.teacher")),O.xb(2),O.Gc(" ",e.lessonPresence.TeacherInformation," ")}}function se(e,t){if(1&e){const e=O.Qb();O.Pb(0,"table",16),O.Pb(1,"thead"),O.Pb(2,"tr"),O.Pb(3,"th"),O.Pb(4,"input",17),O.bc("change",(function(t){return O.uc(e),O.dc(5).toggleAll(t.currentTarget.checked)})),O.Ob(),O.Ob(),O.Pb(5,"th",18),O.Ec(6),O.ec(7,"translate"),O.Ob(),O.Pb(8,"th"),O.Ec(9),O.ec(10,"translate"),O.Lb(11,"br"),O.Ec(12),O.ec(13,"translate"),O.ec(14,"translate"),O.Ob(),O.Pb(15,"th"),O.Ec(16),O.ec(17,"translate"),O.Ob(),O.Pb(18,"th"),O.Ec(19),O.ec(20,"translate"),O.Ob(),O.Pb(21,"th"),O.Ec(22),O.ec(23,"translate"),O.Ob(),O.Pb(24,"th"),O.Ec(25),O.ec(26,"translate"),O.ec(27,"translate"),O.Ob(),O.Pb(28,"th"),O.Ec(29),O.ec(30,"translate"),O.Ob(),O.Ob(),O.Ob(),O.Pb(31,"tbody"),O.Cc(32,ne,35,52,"tr",19),O.Ob(),O.Ob()}if(2&e){const e=O.dc(4).erzLet;O.xb(4),O.jc("checked",e.selection.length===e.entries.length),O.xb(2),O.Gc(" ",O.fc(7,12,"edit-absences.list.header.presence")," "),O.xb(3),O.Gc(" ",O.fc(10,14,"edit-absences.list.header.student")," "),O.xb(3),O.Hc(" ",O.fc(13,16,"edit-absences.list.header.module-instance"),", ",O.fc(14,18,"edit-absences.list.header.study-class")," "),O.xb(4),O.Gc(" ",O.fc(17,20,"edit-absences.list.header.date")," "),O.xb(3),O.Fc(O.fc(20,22,"edit-absences.list.header.time")),O.xb(3),O.Gc(" ",O.fc(23,24,"edit-absences.list.header.confirmation-state")," "),O.xb(3),O.Hc(" ",O.fc(26,26,"edit-absences.list.header.presence-type")," / ",O.fc(27,28,"edit-absences.list.header.incident")," "),O.xb(4),O.Fc(O.fc(30,30,"edit-absences.list.header.teacher")),O.xb(3),O.jc("ngForOf",e.entries)}}function ce(e,t){1&e&&O.Lb(0,"erz-spinner",25)}function ie(e,t){if(1&e){const e=O.Qb();O.Pb(0,"button",26),O.bc("click",(function(){return O.uc(e),O.dc(5).state.nextPage()})),O.Ec(1),O.ec(2,"translate"),O.Ob()}2&e&&(O.xb(1),O.Gc(" ",O.fc(2,1,"global.pagination.load-more")," "))}function ae(e,t){if(1&e){const e=O.Qb();O.Pb(0,"div",7),O.bc("scrolled",(function(){return O.uc(e),O.dc(4).onScroll()})),O.Cc(1,ee,10,21,"div",8),O.Cc(2,se,33,32,"table",9),O.Cc(3,ce,1,0,"erz-spinner",10),O.Cc(4,ie,3,3,"button",11),O.Ob()}if(2&e){const e=O.dc(3).erzLet;O.xb(1),O.jc("ngIf",e.entries&&e.entries.length>0),O.xb(1),O.jc("ngIf",e.entries&&e.entries.length>0),O.xb(1),O.jc("ngIf",e.loadingPage),O.xb(1),O.jc("ngIf",e.hasMore&&!e.loadingPage)}}function re(e,t){1&e&&(O.Pb(0,"p",27),O.Ec(1),O.ec(2,"translate"),O.Ob()),2&e&&(O.xb(1),O.Fc(O.fc(2,1,"edit-absences.no-entries")))}function oe(e,t){if(1&e&&(O.Nb(0),O.Cc(1,ae,5,4,"div",5),O.Cc(2,re,3,3,"ng-template",null,6,O.Dc),O.Mb()),2&e){const e=O.tc(3),t=O.dc(2).erzLet;O.xb(1),O.jc("ngIf",t.entries&&t.entries.length>0||t.loadingPage)("ngIfElse",e)}}function be(e,t){1&e&&O.Lb(0,"erz-spinner")}function le(e,t){if(1&e&&(O.Nb(0),O.Cc(1,oe,4,2,"ng-container",2),O.ec(2,"async"),O.Cc(3,be,1,0,"ng-template",null,4,O.Dc),O.Mb()),2&e){const e=O.tc(4),t=O.dc(2);O.xb(1),O.jc("ngIf",!O.fc(2,2,t.state.loading$))("ngIfElse",e)}}function de(e,t){1&e&&(O.Pb(0,"p",27),O.Ec(1),O.ec(2,"translate"),O.Ob()),2&e&&(O.xb(1),O.Fc(O.fc(2,1,"edit-absences.no-filter")))}function ue(e,t){if(1&e){const e=O.Qb();O.Nb(0),O.Pb(1,"erz-edit-absences-header",1),O.bc("filterChange",(function(t){return O.uc(e),O.dc().state.setFilter(t)})),O.ec(2,"async"),O.Ob(),O.Cc(3,le,5,4,"ng-container",2),O.ec(4,"async"),O.Cc(5,de,3,3,"ng-template",null,3,O.Dc),O.Mb()}if(2&e){const e=O.tc(6),t=O.dc();O.xb(1),O.jc("filter",O.fc(2,3,t.filterFromParams$)),O.xb(2),O.jc("ngIf",O.fc(4,5,t.state.isFilterValid$))("ngIfElse",e)}}const fe=function(e,t,n,s){return{selection:e,entries:t,hasMore:n,loadingPage:s}};let pe=(()=>{class e{constructor(e,t,n,s){this.state=e,this.selectionService=t,this.scrollPosition=n,this.route=s,this.filterFromParams$=this.route.queryParams.pipe(Object(r.a)(he)),this.profileReturnParams$=this.state.queryParamsString$,this.destroy$=new I.a}ngOnInit(){this.filterFromParams$.pipe(Object(S.a)(1)).subscribe(e=>this.state.setFilter(e)),this.state.validFilter$.pipe(Object(o.a)(this.destroy$)).subscribe(()=>this.selectionService.clear()),this.selectionService.selection$.pipe(Object(o.a)(this.destroy$)).subscribe(e=>this.state.selected=e),this.route.queryParams.pipe(Object(S.a)(1),Object($.a)("reload"),Object(E.a)(D.b)).subscribe(()=>this.state.resetEntries())}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}toggleAll(e){this.state.entries$.pipe(Object(S.a)(1)).subscribe(t=>this.selectionService.clear(e?t:null))}onCheckboxCellClick(e,t){e.target!==t&&t.click()}onScroll(){this.state.nextPage()}}return e.\u0275fac=function(t){return new(t||e)(O.Kb(x),O.Kb(k),O.Kb(w.a),O.Kb(c.a))},e.\u0275cmp=O.Eb({type:e,selectors:[["erz-edit-absences-list"]],features:[O.wb([k])],decls:5,vars:14,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3","infiniteScroll","",3,"scrolled",4,"ngIf","ngIfElse"],["noEntries",""],["infiniteScroll","",1,"p-3",3,"scrolled"],["class","d-flex align-items-center justify-content-between",4,"ngIf"],["class","table table-striped",4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between"],[1,"total"],["routerLink","/edit-absences/edit",1,"edit","btn","btn-primary","mt-1","mb-2",3,"queryParams"],[1,"material-icons"],[1,"table","table-striped"],["type","checkbox",3,"checked","change"],[1,"presence-category"],[4,"ngFor","ngForOf"],[1,"edit-absences-checkbox",3,"click"],["checkbox",""],[3,"className"],[1,"student",3,"routerLink","queryParams"],[1,"designation-incident"],[1,"inline"],["type","button",1,"btn","btn-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3","px-3"]],template:function(e,t){1&e&&(O.Cc(0,ue,7,7,"ng-container",0),O.ec(1,"async"),O.ec(2,"async"),O.ec(3,"async"),O.ec(4,"async")),2&e&&O.jc("erzLet",O.qc(9,fe,O.fc(1,1,t.selectionService.selection$),O.fc(2,3,t.state.presenceControlEntries$),O.fc(3,5,t.state.hasMore$),O.fc(4,7,t.state.loadingPage$)))},directives:[A.a,Q,P.m,Y.a,c.g,P.l,U.a],pipes:[P.b,H.c,P.e],styles:[".edit[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}.presence-category[_ngcontent-%COMP%]{text-align:center}.presence-category[_ngcontent-%COMP%]   .absent[_ngcontent-%COMP%]{color:#dc3545}.presence-category[_ngcontent-%COMP%]   .present[_ngcontent-%COMP%]{color:#28a745}.presence-category[_ngcontent-%COMP%]   .unapproved[_ngcontent-%COMP%]{color:#ffa814}.designation-incident[_ngcontent-%COMP%]{max-width:50ch}.student[_ngcontent-%COMP%]{color:#33333d}@media screen and (max-width:820px){.edit-absences-checkbox[_ngcontent-%COMP%]{text-align:left}.presence-category[_ngcontent-%COMP%]{text-align:right}.designation-incident[_ngcontent-%COMP%]{max-width:none}}"],changeDetection:0}),e})();function he(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null,dateFrom:e.dateFrom?Object(G.c)(e.dateFrom):null,dateTo:e.dateTo?Object(G.c)(e.dateTo):null,presenceType:e.presenceType?Number(e.presenceType):null,confirmationState:e.confirmationState?Number(e.confirmationState):null,incidentType:e.incidentType?Number(e.presenceType):null}}var me=n("3Pt+"),ge=n("2Vo4"),ye=n("eIep"),ve=n("nYR2"),Oe=n("BeL+"),Pe=n("CqXF"),xe=n("LpL1"),Ce=n("IClS"),je=function(e){return e.Absent="absent",e.Dispensation="dispensation",e.HalfDay="half-day",e.Incident="incident",e.Present="present",e}({});let Ie=(()=>{class e{constructor(e,t){this.updateService=e,this.settings=t}update(e,t,n,s,c,a){let r=[];switch(n){case je.Present:r=this.createResetBulkRequests(e);break;case je.Absent:r=this.createAbsentEditBulkRequests(e,t,s,c);break;case je.Dispensation:r=this.createEditBulkRequests(e,null,this.settings.dispensationPresenceTypeId);break;case je.HalfDay:r=this.createEditBulkRequests(e,null,this.settings.halfDayPresenceTypeId);break;case je.Incident:r=this.createEditBulkRequests(e,null,a)}return Object(i.a)(r).pipe(Object(Pe.a)(void 0))}createAbsentEditBulkRequests(e,t,n,s){return n===this.settings.excusedAbsenceStateId?this.createEditBulkRequests(e,n,s):n===this.settings.unexcusedAbsenceStateId?this.createEditBulkRequests(e,n,this.settings.absencePresenceTypeId):[...this.createEditBulkRequests(e.filter(Se(t,this.settings)),n,this.settings.absencePresenceTypeId),...this.createEditBulkRequests(e.filter(Object(D.d)(Se(t,this.settings))),n,null)]}createResetBulkRequests(e){return Object(Ce.a)(e).map(({lessonIds:e,personIds:t})=>this.updateService.removeLessonPresences(e,t))}createEditBulkRequests(e,t,n){return Object(Ce.a)(e).map(({lessonIds:e,personIds:s})=>this.updateService.editLessonPresences(e,s,n||void 0,t||void 0))}}return e.\u0275fac=function(t){return new(t||e)(O.Xb(xe.a),O.Xb(g.a))},e.\u0275prov=O.Gb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Se(e,t){return n=>{const s=e.find(e=>e.Id===n.TypeRef.Id);return!s||s.Id===t.dispensationPresenceTypeId||s.Id===t.halfDayPresenceTypeId||s.IsIncident}}var $e=n("A6ef"),Ee=n("AEFh"),Te=n("5eHb");function ke(e,t){if(1&e&&(O.Pb(0,"div",11),O.Ec(1),O.ec(2,"translate"),O.Ob()),2&e){const e=t.$implicit;O.xb(1),O.Gc(" ",O.gc(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Fe(e,t){if(1&e&&(O.Pb(0,"option",23),O.Ec(1),O.Ob()),2&e){const e=t.$implicit;O.jc("ngValue",e.Id),O.xb(1),O.Gc(" ",e.Designation," ")}}function we(e,t){if(1&e&&(O.Pb(0,"select",22),O.ec(1,"async"),O.Pb(2,"option",23),O.Ec(3),O.ec(4,"translate"),O.Ob(),O.Cc(5,Fe,2,2,"option",24),O.ec(6,"async"),O.Ob()),2&e){const e=O.dc(6);O.Cb("is-invalid",O.fc(1,5,e.absenceTypeIdErrors$).length>0),O.xb(2),O.jc("ngValue",null),O.xb(1),O.Gc(" ",O.fc(4,7,"edit-absences.edit.absence-type-placeholder")," "),O.xb(2),O.jc("ngForOf",O.fc(6,9,e.absenceTypes$))}}function Ge(e,t){if(1&e&&(O.Pb(0,"div",25),O.Ec(1),O.ec(2,"translate"),O.Ob()),2&e){const e=t.$implicit;O.xb(1),O.Gc(" ",O.gc(2,1,"global.validation-errors."+e.error,e.params)," ")}}function De(e,t){if(1&e&&(O.Pb(0,"div",18),O.Lb(1,"input",19),O.Pb(2,"label",14),O.Ec(3),O.Ob(),O.Cc(4,we,7,11,"select",20),O.Cc(5,Ge,3,4,"div",21),O.ec(6,"async"),O.Ob()),2&e){const e=t.$implicit,n=O.dc(5);O.xb(1),O.jc("id","state-"+e.Key)("value",e.Key),O.xb(1),O.kc("for","state-"+e.Key),O.xb(1),O.Gc(" ",e.Value," "),O.xb(1),O.jc("ngIf",n.isExcused(e)),O.xb(1),O.jc("ngForOf",O.fc(6,6,n.absenceTypeIdErrors$))}}function Ae(e,t){if(1&e&&(O.Pb(0,"div",16),O.Cc(1,De,7,8,"div",17),O.Ob()),2&e){const e=O.dc(3).erzLet;O.xb(1),O.jc("ngForOf",e.confirmationStates)}}function ze(e,t){if(1&e&&(O.Pb(0,"option",23),O.Ec(1),O.Ob()),2&e){const e=t.$implicit;O.jc("ngValue",e.Id),O.xb(1),O.Gc(" ",e.Designation," ")}}function Le(e,t){if(1&e&&(O.Pb(0,"div",25),O.Ec(1),O.ec(2,"translate"),O.Ob()),2&e){const e=t.$implicit;O.xb(1),O.Gc(" ",O.gc(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Ke(e,t){if(1&e&&(O.Pb(0,"div",16),O.Pb(1,"select",26),O.ec(2,"async"),O.Pb(3,"option",23),O.Ec(4),O.ec(5,"translate"),O.Ob(),O.Cc(6,ze,2,2,"option",24),O.ec(7,"async"),O.Ob(),O.Cc(8,Le,3,4,"div",21),O.ec(9,"async"),O.Ob()),2&e){const e=O.dc(4);O.xb(1),O.Cb("is-invalid",O.fc(2,6,e.incidentIdErrors$).length>0),O.xb(2),O.jc("ngValue",null),O.xb(1),O.Gc(" ",O.fc(5,8,"edit-absences.edit.incident-placeholder")," "),O.xb(2),O.jc("ngForOf",O.fc(7,10,e.incidents$)),O.xb(2),O.jc("ngForOf",O.fc(9,12,e.incidentIdErrors$))}}function qe(e,t){if(1&e&&(O.Pb(0,"div",12),O.Lb(1,"input",13),O.Pb(2,"label",14),O.Ec(3),O.ec(4,"translate"),O.Ob(),O.Cc(5,Ae,2,1,"div",15),O.Cc(6,Ke,10,14,"div",15),O.Ob()),2&e){const e=t.$implicit,n=O.dc(3);O.xb(1),O.jc("id","category-"+e)("value",e),O.xb(1),O.kc("for","category-"+e),O.xb(1),O.Gc(" ",O.fc(4,6,"edit-absences.edit.categories."+e)," "),O.xb(2),O.jc("ngIf",n.isAbsent(e)),O.xb(1),O.jc("ngIf",n.isIncident(e))}}function Me(e,t){1&e&&(O.Pb(0,"div",27),O.Pb(1,"span",28),O.Ec(2,"Loading..."),O.Ob(),O.Ob())}function Ve(e,t){if(1&e){const e=O.Qb();O.Pb(0,"form",3),O.bc("ngSubmit",(function(){return O.uc(e),O.dc(2).onSubmit()})),O.Cc(1,ke,3,4,"div",4),O.ec(2,"async"),O.Pb(3,"div",5),O.Cc(4,qe,7,8,"div",6),O.Ob(),O.Pb(5,"div",7),O.Pb(6,"button",8),O.bc("click",(function(){return O.uc(e),O.dc(2).cancel()})),O.ec(7,"async"),O.Ec(8),O.ec(9,"translate"),O.Ob(),O.Pb(10,"button",9),O.ec(11,"async"),O.Ec(12),O.ec(13,"translate"),O.Cc(14,Me,3,0,"div",10),O.ec(15,"async"),O.Ob(),O.Ob(),O.Ob()}if(2&e){const e=O.dc().erzLet,t=O.dc();O.jc("formGroup",e.formGroup),O.xb(1),O.jc("ngForOf",O.fc(2,8,t.formErrors$)),O.xb(3),O.jc("ngForOf",e.categories),O.xb(2),O.jc("disabled",O.fc(7,10,t.saving$)),O.xb(2),O.Gc(" ",O.fc(9,12,"edit-absences.edit.cancel")," "),O.xb(2),O.jc("disabled",O.fc(11,14,t.saving$)),O.xb(2),O.Gc(" ",O.fc(13,16,"edit-absences.edit.save")," "),O.xb(2),O.jc("ngIf",O.fc(15,18,t.saving$))}}function Re(e,t){if(1&e&&(O.Pb(0,"div",1),O.Cc(1,Ve,16,20,"form",2),O.Ob()),2&e){const e=t.erzLet;O.xb(1),O.jc("ngIf",e.formGroup&&e.confirmationStates)}}const Ne=function(e,t,n){return{confirmationStates:e,categories:t,formGroup:n}};let Be=(()=>{class e{constructor(e,t,n,s,c,i,o,b,l,d){this.fb=e,this.router=t,this.route=n,this.toastr=s,this.translate=c,this.state=i,this.dropDownItemsService=o,this.presenceTypesService=b,this.updateService=l,this.settings=d,this.absenceTypes$=this.presenceTypesService.confirmationTypes$,this.incidents$=this.presenceTypesService.incidentTypes$,this.formGroup$=this.createFormGroup(),this.saving$=new ge.a(!1),this.submitted$=new ge.a(!1),this.formErrors$=Object($e.c)(this.formGroup$,this.submitted$),this.absenceTypeIdErrors$=Object($e.c)(this.formGroup$,this.submitted$,"absenceTypeId"),this.incidentIdErrors$=Object($e.c)(this.formGroup$,this.submitted$,"incidentId"),this.availableCategories=[je.Absent,je.Dispensation,je.HalfDay,je.Incident,je.Present],this.confirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(Object(r.a)(this.sortAbsenceConfirmationStates.bind(this)),Object(a.a)(1)),this.activeCategories$=this.presenceTypesService.halfDayActive$.pipe(Object(r.a)(e=>e?this.availableCategories:this.availableCategories.filter(e=>e!==je.HalfDay))),this.destroy$=new I.a}ngOnInit(){0===this.state.selected.length&&this.navigateBack(),Object($e.b)(this.formGroup$,"category").pipe(Object(o.a)(this.destroy$)).subscribe(this.updateConfirmationValueDisabled.bind(this)),Object($e.b)(this.formGroup$,"confirmationValue").pipe(Object(o.a)(this.destroy$)).subscribe(this.updateAbsenceTypeIdDisabled.bind(this))}ngOnDestroy(){this.destroy$.next()}isAbsent(e){return e===je.Absent}isExcused(e){return e.Key===this.settings.excusedAbsenceStateId}isIncident(e){return e===je.Incident}onSubmit(){this.submitted$.next(!0),this.formGroup$.pipe(Object(S.a)(1)).subscribe(e=>{e.valid&&this.save(e)})}cancel(){this.navigateBack()}createFormGroup(){return this.getInitialAbsenceTypeId().pipe(Object(r.a)(e=>this.fb.group({category:[je.Absent,me.p.required],confirmationValue:[this.settings.excusedAbsenceStateId,me.p.required],absenceTypeId:[e,me.p.required],incidentId:[{value:null,disabled:!0},me.p.required]})),Object(a.a)(1))}getInitialAbsenceTypeId(){return this.absenceTypes$.pipe(Object(S.a)(1),Object(r.a)(e=>{const t=e.map(e=>e.Id),n=Object(Oe.a)(this.state.selected.map(e=>e.TypeRef.Id));return 1===n.length&&null!=n[0]&&t.includes(n[0])?n[0]:null}))}updateConfirmationValueDisabled(){this.formGroup$.pipe(Object(S.a)(1)).subscribe(e=>{const t=e.get("category"),n=e.get("confirmationValue"),s=e.get("absenceTypeId"),c=e.get("incidentId");t&&n&&s&&c&&(t.value===je.Absent?(n.enable(),this.updateAbsenceTypeIdDisabled()):(n.disable(),s.disable()),t.value===je.Incident?c.enable():c.disable())})}updateAbsenceTypeIdDisabled(){this.formGroup$.pipe(Object(S.a)(1)).subscribe(e=>{const t=e.get("confirmationValue"),n=e.get("absenceTypeId");t&&n&&(t.value===this.settings.excusedAbsenceStateId?n.enable():n.disable())})}save(e){this.saving$.next(!0);const{category:t,confirmationValue:n,absenceTypeId:s,incidentId:c}=e.value;this.presenceTypesService.presenceTypes$.pipe(Object(ye.a)(e=>this.updateService.update(this.state.selected,e,t,n,s,c)),Object(ve.a)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.resetSelection(),this.toastr.success(this.translate.instant("edit-absences.edit.save-success")),this.navigateBack(!0)}navigateBack(e){this.route.queryParams.pipe(Object(S.a)(1)).subscribe(t=>{this.router.navigate(["/edit-absences"],{queryParams:Object.assign(Object.assign({},Object(Ee.a)(t.returnparams)),{reload:e})})})}sortAbsenceConfirmationStates(e){return e.slice().sort((e,t)=>e.Key===this.settings.excusedAbsenceStateId?-1:t.Key===this.settings.excusedAbsenceStateId?1:e.Value.localeCompare(t.Value))}}return e.\u0275fac=function(t){return new(t||e)(O.Kb(me.b),O.Kb(c.e),O.Kb(c.a),O.Kb(Te.b),O.Kb(H.d),O.Kb(x),O.Kb(b.a),O.Kb(u.a),O.Kb(Ie),O.Kb(g.a))},e.\u0275cmp=O.Eb({type:e,selectors:[["erz-edit-absences-edit"]],decls:4,vars:11,consts:[["class","erz-container erz-container-limited erz-container-padding-y",4,"erzLet"],[1,"erz-container","erz-container-limited","erz-container-padding-y"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["class","alert alert-danger",4,"ngFor","ngForOf"],[1,"form-group","pb-4"],["class","form-check mt-2 mb-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"alert","alert-danger"],[1,"form-check","mt-2","mb-3"],["type","radio","formControlName","category",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],["class","ml-5",4,"ngIf"],[1,"ml-5"],["class","form-check mt-2 mb-2",4,"ngFor","ngForOf"],[1,"form-check","mt-2","mb-2"],["type","radio","formControlName","confirmationValue",1,"form-check-input",3,"id","value"],["class","form-control mt-1","formControlName","absenceTypeId",3,"is-invalid",4,"ngIf"],["class","invalid-feedback",4,"ngFor","ngForOf"],["formControlName","absenceTypeId",1,"form-control","mt-1"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"invalid-feedback"],["formControlName","incidentId",1,"form-control","mt-1"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,t){1&e&&(O.Cc(0,Re,2,1,"div",0),O.ec(1,"async"),O.ec(2,"async"),O.ec(3,"async")),2&e&&O.jc("erzLet",O.pc(7,Ne,O.fc(1,1,t.confirmationStates$),O.fc(2,3,t.activeCategories$),O.fc(3,5,t.formGroup$)))},directives:[A.a,P.m,me.r,me.i,me.d,P.l,me.m,me.a,me.h,me.c,me.o,me.l,me.q],pipes:[P.b,H.c],styles:[""],changeDetection:0}),e})();var _e=n("ccj6"),Xe=n("hH5/");const He=[{path:"",component:j,children:[{path:"",component:pe,data:{restoreScrollPositionFrom:["/edit-absences/edit","/edit-absences/student/:id"]}},{path:"edit",component:Be},{path:"student/:id",children:[{path:"",component:_e.a},{path:"confirm",component:Xe.a}]}]}];let Qe=(()=>{class e{}return e.\u0275mod=O.Ib({type:e}),e.\u0275inj=O.Hb({factory:function(t){return new(t||e)},imports:[[c.h.forChild(He)],c.h]}),e})();var Je=n("0HM3");let Ye=(()=>{class e{}return e.\u0275mod=O.Ib({type:e}),e.\u0275inj=O.Hb({factory:function(t){return new(t||e)},providers:[{provide:Je.a,useValue:"/edit-absences"}],imports:[[s.a,Qe]]}),e})()}}]);