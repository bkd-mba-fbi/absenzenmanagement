!function(){function e(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||t(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],s=!0,i=!1,c=void 0;try{for(var r,o=e[Symbol.iterator]();!(s=(r=o.next()).done)&&(t.push(r.value),!n||t.length!==n);s=!0);}catch(a){i=!0,c=a}finally{try{s||null==o.return||o.return()}finally{if(i)throw c}}return t}(e,n)||t(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,n){if(e){if("string"==typeof e)return s(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?s(e,n):void 0}}function s(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,s=new Array(n);t<n;t++)s[t]=e[t];return s}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function c(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function r(e,n,t){return n&&c(e.prototype,n),t&&c(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"2TIA":function(t,s,c){"use strict";c.r(s),c.d(s,"PresenceControlModule",(function(){return an}));var o=c("PCNd"),a=c("tyNb"),d=c("XNiG"),l=c("1G5W"),u=c("2Vo4"),p=c("VRyK"),b=c("itXk"),g=c("PqYM"),f=c("/uUt"),h=c("eIep"),m=c("UXun"),v=c("lJxs"),y=c("IzEk"),P=c("Muja"),O=c("BeL+"),C=c("sWYD"),w=c("CCnw"),M=c("CqUA"),j=c("KJh6"),k=c("eB9A"),x=c("BzUC");function _(e){return function(n){return n.reduce((function(n,t){return n+(t.presenceCategory===e?1:0)}),0)}}function I(e){return e.filter((function(e){return!e.lessonPresence.WasAbsentInPrecedingLesson}))}function $(e){return e.filter((function(e){return e.lessonPresence.WasAbsentInPrecedingLesson}))}var L,T,S=c("vlqf"),E=c("Xr/R"),D=c("G6Tw"),U=c("jIYg"),A=c("v6cN"),R=c("AEFh"),F=c("fXoL"),z=c("ofXK"),G=function(e){return e.Grid="grid",e.List="list",e}({}),H=Object.keys(G).map((function(e){return G[e]})),K=((L=function(){function e(n,t,s,c,r,o){var a=this;i(this,e),this.lessonPresencesService=n,this.presenceTypesService=t,this.dropDownItemsService=s,this.loadingService=c,this.settings=r,this.location=o,this.selectedDateSubject$=new u.a(new Date),this.selectLesson$=new d.a,this.viewModeSubject$=new u.a(G.Grid),this.updateLessonPresences$=new d.a,this.lessonPresences$=Object(p.a)(this.selectedDateSubject$.pipe(Object(f.a)(P.a),Object(h.a)(this.loadLessonPresencesByDate.bind(this))),this.updateLessonPresences$).pipe(Object(m.a)(1)),this.presenceTypes$=this.loadPresenceTypes().pipe(Object(m.a)(1)),this.lessons$=this.lessonPresences$.pipe(Object(v.a)(x.a),Object(m.a)(1)),this.currentLesson$=this.lessons$.pipe(Object(v.a)(x.b),Object(f.a)(x.e)),this.studentIdsWithUnconfirmedAbsences$=this.selectedDateSubject$.pipe(Object(h.a)((function(){return a.loadStudentIdsWithUnconfirmedAbsences()})),Object(m.a)(1)),this.loading$=this.loadingService.loading$,this.selectedLesson$=Object(p.a)(this.currentLesson$,this.selectLesson$).pipe(Object(m.a)(1)),this.absenceConfirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(Object(m.a)(1)),this.selectedPresenceControlEntries$=Object(b.a)([this.selectedLesson$,this.lessonPresences$,this.presenceTypes$,this.absenceConfirmationStates$]).pipe(Object(v.a)(Object(k.a)(x.c)),Object(m.a)(1)),this.presentCount$=this.selectedPresenceControlEntries$.pipe(Object(v.a)(_("present"))),this.absentCount$=this.selectedPresenceControlEntries$.pipe(Object(v.a)(_("absent"))),this.unapprovedCount$=this.selectedPresenceControlEntries$.pipe(Object(v.a)(_("unapproved"))),this.viewMode$=this.viewModeSubject$.asObservable(),this.selectedDate$=this.selectedDateSubject$.asObservable(),this.queryParams$=Object(b.a)([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(Object(v.a)(Object(k.a)(this.buildQueryParams.bind(this)))),this.queryParamsString$=Object(b.a)([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(Object(v.a)(Object(k.a)(this.buildQueryParams.bind(this))),Object(v.a)(R.b)),this.destroy$=new d.a,this.queryParamsString$.pipe(Object(l.a)(this.destroy$)).subscribe((function(e){a.location.replaceState("/presence-control",e),a.confirmBackLinkParams={returnparams:e}}))}return r(e,[{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"setDate",value:function(e){this.selectedDateSubject$.next(e)}},{key:"setLesson",value:function(e){this.selectLesson$.next(e)}},{key:"setViewMode",value:function(e){this.viewModeSubject$.next(e)}},{key:"updateLessonPresencesTypes",value:function(e){var t=this;Object(b.a)([this.lessonPresences$.pipe(Object(y.a)(1)),this.presenceTypes$.pipe(Object(y.a)(1))]).pipe(Object(v.a)((function(s){var i=n(s,2),c=i[0],r=i[1];return function(e,n,t,s){return e.map((function(e){var i,c,r=n.find((function(n){return(t=n.presence).LessonRef.Id===(s=e).LessonRef.Id&&t.StudentRef.Id===s.StudentRef.Id;var t,s}));return r?(i=!r.newPresenceTypeId&&e.Comment?t.find((function(e){return e.IsComment}))||null:t.find((function(e){return e.Id===r.newPresenceTypeId}))||null,Object.assign(Object.assign({},e),{TypeRef:(c=i,{Id:c?c.Id:null,HRef:null}),Date:null,Type:i?i.Designation:null,ConfirmationStateId:Object(S.b)(i,s)})):e}))}(c,e,r,t.settings)}))).subscribe((function(e){return t.updateLessonPresences$.next(e)}))}},{key:"getNextPresenceType",value:function(e){return this.presenceTypes$.pipe(Object(y.a)(1),Object(v.a)((function(n){return e.getNextPresenceType(n)})))}},{key:"getPresenceControlEntry",value:function(e,n){return this.selectedPresenceControlEntries$.pipe(Object(y.a)(1),Object(v.a)((function(t){return t.find((function(t){return t.lessonPresence.StudentRef.Id===e&&t.lessonPresence.LessonRef.Id===n}))||null})))}},{key:"hasUnconfirmedAbsences",value:function(e){return this.studentIdsWithUnconfirmedAbsences$.pipe(Object(v.a)((function(n){return n.includes(e.lessonPresence.StudentRef.Id)})))}},{key:"getBlockLessonPresences",value:function(e){var t=this;return Object(b.a)([this.lessonPresences$.pipe(Object(y.a)(1)),this.presenceTypes$.pipe(Object(y.a)(1))]).pipe(Object(v.a)((function(s){var i=n(s,2),c=i[0],r=i[1];return c.filter((function(n){return n.EventRef.Id===e.lessonPresence.EventRef.Id&&n.StudentRef.Id===e.lessonPresence.StudentRef.Id&&Object(S.a)(n,r.find((function(e){return e.Id===n.TypeRef.Id}))||null,t.settings)})).sort((function(e,n){return e.LessonDateTimeFrom>n.LessonDateTimeFrom?1:-1}))})))}},{key:"loadLessonPresencesByDate",value:function(e){return this.loadingService.load(function(e){return Object(U.a)(1,arguments),Object(D.a)(e,Date.now())}(e)?this.lessonPresencesService.getListForToday():this.lessonPresencesService.getListByDate(e))}},{key:"loadPresenceTypes",value:function(){return this.loadingService.load(this.presenceTypesService.presenceTypes$)}},{key:"loadStudentIdsWithUnconfirmedAbsences",value:function(){var e=this;return Object(g.a)(0,this.settings.unconfirmedAbsencesRefreshTime||void 0).pipe(Object(h.a)((function(){return e.lessonPresencesService.getListOfUnconfirmed()})),Object(v.a)((function(e){return Object(O.a)(e.map((function(e){return e.StudentRef.Id})))})))}},{key:"buildQueryParams",value:function(e,n,t){var s={date:Object(C.a)(e,"yyyy-MM-dd"),viewMode:t};return n&&(s.lesson=String(n.LessonRef.Id)),s}}]),e}()).\u0275fac=function(e){return new(e||L)(F.Xb(w.a),F.Xb(j.a),F.Xb(A.a),F.Xb(M.a),F.Xb(E.a),F.Xb(z.i))},L.\u0275prov=F.Gb({token:L,factory:L.\u0275fac}),L),X=c("LRne"),N=c("Kqap"),Q=c("w1tV"),q=c("Kj3r"),V=c("pLZG"),B=c("bOdf"),W=c("CqXF"),J=c("JIr8"),Y=c("PduT"),Z=c("8teX"),ee=c("K+0v"),ne=c("LpL1"),te=c("5eHb"),se=c("sYmb"),ie=function(e){return e.AddUpdateAction="ADD",e.RemoveUpdateAction="REMOVE",e}({}),ce=((T=function(){function n(e,t,s,c,r){i(this,n),this.toastr=e,this.translate=t,this.restService=s,this.presenceTypesService=c,this.settings=r,this.destroy$=new d.a,this.action$=new d.a,this.pendingUpdates$=this.action$.pipe(Object(N.a)(this.reduceUpdates.bind(this),[]),Object(Q.a)()),this.revertUpdates$=new d.a,this.performUpdates$=this.pendingUpdates$.pipe(Object(q.a)(3e3),Object(V.a)(Object(ee.d)(Z.b)),Object(B.a)(this.performUpdates.bind(this))),this.stateUpdates$=Object(p.a)(this.pendingUpdates$,this.revertUpdates$).pipe(Object(q.a)(20),Object(V.a)(Object(ee.d)(Z.b))),this.performUpdates$.pipe(Object(l.a)(this.destroy$)).subscribe()}return r(n,[{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"updatePresenceTypes",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.forEach((function(e){return n.dispatchAddUpdate(e,t)}))}},{key:"performUpdates",value:function(e){var n=this,t=this.groupUpdates(e);return Object(b.a)(Object.keys(t).reduce((function(e,s){var i=t[s];return Object.keys(i).forEach((function(t){e.push(n.performUpdateForGroup(i[t]))})),e}),[])).pipe(Object(W.a)(t))}},{key:"performUpdateForGroup",value:function(e){var n=this;return e.forEach((function(e){return n.dispatchRemoveUpdate(e.presence)})),this.performLessonPresencesUpdatesByIds(e[0].presence.LessonRef.Id,e.map((function(e){return e.presence.StudentRef.Id})),e[0].newPresenceTypeId).pipe(Object(J.a)((function(t){return n.revertUpdatesAfterError(e,t)})))}},{key:"performLessonPresencesUpdatesByIds",value:function(e,n){var t=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return s?(s?this.presenceTypesService.getPresenceType(s):Object(X.a)(null)).pipe(Object(h.a)((function(s){return t.restService.editLessonPresences([e],n,null==s?void 0:s.Id,Object(S.b)(s,t.settings)||void 0,Object(Y.b)({disableErrorHandling:!0}))}))):this.restService.removeLessonPresences([e],n,Object(Y.b)({disableErrorHandling:!0}))}},{key:"revertUpdatesAfterError",value:function(e,n){return console.error("Bulk-update of lesson presences failed"),console.error(n),this.toastr.error(this.translate.instant("shared.lesson-presences-update.error")),this.revertUpdates$.next(e.map((function(e){return Object.assign(Object.assign({},e),{newPresenceTypeId:e.presence.TypeRef.Id})}))),Object(X.a)(void 0)}},{key:"groupUpdates",value:function(e){return e.reduce((function(e,n){var t=String(n.newPresenceTypeId&&n.newPresenceTypeId);return e[t]||(e[t]={}),Array.isArray(e[t][n.presence.LessonRef.Id])||(e[t][n.presence.LessonRef.Id]=[]),e[t][n.presence.LessonRef.Id].push(n),e}),{})}},{key:"reduceUpdates",value:function(n,t){switch(t.type){case ie.AddUpdateAction:var s=t.payload,i=s.presence,c=s.newPresenceTypeId,r=n.findIndex(re(i));return-1===r?[].concat(e(n),[{presence:i,newPresenceTypeId:c}]):[].concat(e(n.slice(0,r)),[{presence:n[r].presence,newPresenceTypeId:c}],e(n.slice(r+1)));case ie.RemoveUpdateAction:return n.filter(Object(ee.d)(re(t.payload)));default:return n}}},{key:"dispatchAddUpdate",value:function(e,n){this.action$.next({type:ie.AddUpdateAction,payload:{presence:e,newPresenceTypeId:n}})}},{key:"dispatchRemoveUpdate",value:function(e){this.action$.next({type:ie.RemoveUpdateAction,payload:e})}}]),n}()).\u0275fac=function(e){return new(e||T)(F.Xb(te.b),F.Xb(se.d),F.Xb(ne.a),F.Xb(j.a),F.Xb(E.a))},T.\u0275prov=F.Gb({token:T,factory:T.\u0275fac,providedIn:"root"}),T);function re(e){return function(n){return n.presence.LessonRef.Id===e.LessonRef.Id&&n.presence.StudentRef.Id===e.StudentRef.Id}}var oe,ae=c("qUtt"),de=((oe=function(){function e(n,t){i(this,e),this.state=n,this.lessonPresencesUpdateService=t,this.destroy$=new d.a}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.lessonPresencesUpdateService.stateUpdates$.pipe(Object(l.a)(this.destroy$)).subscribe((function(n){return e.state.updateLessonPresencesTypes(n)}))}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}}]),e}()).\u0275fac=function(e){return new(e||oe)(F.Kb(K),F.Kb(ce))},oe.\u0275cmp=F.Eb({type:oe,selectors:[["erz-presence-control"]],features:[F.wb([K,{provide:ae.a,useExisting:K}])],decls:1,vars:0,template:function(e,n){1&e&&F.Lb(0,"router-outlet")},directives:[a.i],styles:[""],changeDetection:0}),oe),le=c("jiSq"),ue=(c("RYjX"),c("1kSV")),pe=c("3Pt+");function be(e,n){if(1&e&&(F.Pb(0,"div",5),F.Pb(1,"input",6),F.bc("change",(function(){var e=n.$implicit;return e.selected=!e.selected})),F.Ob(),F.Pb(2,"label",7),F.Ec(3),F.ec(4,"date"),F.ec(5,"date"),F.Ob(),F.Ob()),2&e){var t=n.$implicit,s=n.index;F.xb(1),F.lc("id","lesson-presence-",s,""),F.jc("checked",t.selected),F.xb(1),F.lc("for","lesson-presence-",s,""),F.xb(1),F.Hc(" ",F.gc(4,5,t.lessonPresence.LessonDateTimeFrom,"HH:mm"),"\u2013",F.gc(5,8,t.lessonPresence.LessonDateTimeTo,"HH:mm"),"")}}var ge,fe=((ge=function(){function e(n){i(this,e),this.activeModal=n,this.lessonPresenceOptions=[]}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.lessonPresenceOptions=this.blockLessonPresences.map((function(n){return e.createLessonPresenceOption(n)}))}},{key:"getSelectedLessonPresences",value:function(){return this.lessonPresenceOptions.filter((function(e){return e.selected})).map((function(e){return e.lessonPresence}))}},{key:"createLessonPresenceOption",value:function(e){return{lessonPresence:e,selected:!0}}}]),e}()).\u0275fac=function(e){return new(e||ge)(F.Kb(ue.b))},ge.\u0275cmp=F.Eb({type:ge,selectors:[["erz-presence-control-dialog-component"]],inputs:{entry:"entry",blockLessonPresences:"blockLessonPresences"},decls:13,vars:11,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"form-group","form-check"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label",3,"for"]],template:function(e,n){1&e&&(F.Pb(0,"div",0),F.Pb(1,"p"),F.Ec(2),F.ec(3,"translate"),F.Ob(),F.Pb(4,"form"),F.Cc(5,be,6,11,"div",1),F.Ob(),F.Ob(),F.Pb(6,"div",2),F.Pb(7,"button",3),F.bc("click",(function(){return n.activeModal.close()})),F.Ec(8),F.ec(9,"translate"),F.Ob(),F.Pb(10,"button",4),F.bc("click",(function(){return n.activeModal.close(n.getSelectedLessonPresences())})),F.Ec(11),F.ec(12,"translate"),F.Ob(),F.Ob()),2&e&&(F.xb(2),F.Gc(" ",F.fc(3,5,"presence-control.dialog.text")," "),F.xb(3),F.jc("ngForOf",n.lessonPresenceOptions),F.xb(3),F.Gc(" ",F.fc(9,7,"presence-control.dialog.cancel")," "),F.xb(2),F.jc("disabled",0===n.getSelectedLessonPresences().length),F.xb(1),F.Gc(" ",F.fc(12,9,"presence-control.dialog.save")," "))},directives:[pe.r,pe.i,pe.j,z.l],pipes:[se.c,z.e],encapsulation:2}),ge),he=c("yl8S"),me=c("KCaQ");function ve(e,n){if(1&e){var t=F.Qb();F.Pb(0,"div",5),F.Pb(1,"input",6),F.bc("change",(function(){F.uc(t);var e=n.$implicit;return F.dc().onSelectionChange(e)})),F.Ob(),F.Pb(2,"label",7),F.Ec(3),F.Ob(),F.Ob()}if(2&e){var s=n.$implicit,i=n.index,c=F.dc();F.xb(1),F.lc("id","incident-",i,""),F.jc("checked",s.id===c.selected.id)("value",s.id),F.xb(1),F.lc("for","incident-",i,""),F.xb(1),F.Gc(" ",s.label," ")}}var ye,Pe=((ye=function(){function e(n,t){i(this,e),this.activeModal=n,this.translate=t,this.incidentOptions=[]}return r(e,[{key:"ngOnInit",value:function(){var e=this,n=this.createIncidentOption();this.incidentOptions=this.incidentTypes.map((function(n){return e.createIncidentOption(n)})),this.incidentOptions.unshift(n),this.selected=this.incidentOptions.find((function(n){var t;return n.id===(null===(t=e.incident)||void 0===t?void 0:t.Id)}))||n}},{key:"createIncidentOption",value:function(e){return{id:e?e.Id:null,label:e?e.Designation:this.translate.instant("presence-control.incident.no-incident")}}},{key:"onSelectionChange",value:function(e){this.selected=e}},{key:"getSelectedIncident",value:function(){var e=this;return this.incidentTypes.find((function(n){var t;return n.Id===(null===(t=e.selected)||void 0===t?void 0:t.id)}))||null}}]),e}()).\u0275fac=function(e){return new(e||ye)(F.Kb(ue.b),F.Kb(se.d))},ye.\u0275cmp=F.Eb({type:ye,selectors:[["erz-presence-control-incident"]],inputs:{incident:"incident",incidentTypes:"incidentTypes"},decls:13,vars:10,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"form-group","form-check"],["type","radio","name","incident",1,"form-check-input",3,"id","checked","value","change"],[1,"form-check-label",3,"for"]],template:function(e,n){1&e&&(F.Pb(0,"div",0),F.Pb(1,"p"),F.Ec(2),F.ec(3,"translate"),F.Ob(),F.Pb(4,"form"),F.Cc(5,ve,4,5,"div",1),F.Ob(),F.Ob(),F.Pb(6,"div",2),F.Pb(7,"button",3),F.bc("click",(function(){return n.activeModal.dismiss()})),F.Ec(8),F.ec(9,"translate"),F.Ob(),F.Pb(10,"button",4),F.bc("click",(function(){return n.activeModal.close(n.getSelectedIncident())})),F.Ec(11),F.ec(12,"translate"),F.Ob(),F.Ob()),2&e&&(F.xb(2),F.Gc(" ",F.fc(3,4,"presence-control.incident.text")," "),F.xb(3),F.jc("ngForOf",n.incidentOptions),F.xb(3),F.Gc(" ",F.fc(9,6,"presence-control.incident.cancel")," "),F.xb(3),F.Gc(" ",F.fc(12,8,"presence-control.incident.save")," "))},directives:[pe.r,pe.i,pe.j,z.l],pipes:[se.c],styles:["form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-bottom:.75rem;border-bottom:1px solid #e9ecef}"]}),ye),Oe=c("EOpz"),Ce=c("YDIV");function we(e,n){if(1&e){var t=F.Qb();F.Pb(0,"div",21),F.bc("click",(function(){return F.uc(t),F.dc().lessonDropdown.toggle()})),F.Ec(1),F.ec(2,"date"),F.Pb(3,"span",22),F.Ec(4),F.ec(5,"date"),F.Ob(),F.Ob()}if(2&e){var s=F.dc();F.xb(1),F.Gc(" ",F.gc(2,2,s.selectedLesson.LessonDateTimeFrom,"HH:mm"),"\u2013"),F.xb(3),F.Fc(F.gc(5,5,s.selectedLesson.LessonDateTimeTo,"HH:mm"))}}function Me(e,n){if(1&e){var t=F.Qb();F.Pb(0,"div",27),F.bc("click",(function(){F.uc(t);var e=n.$implicit;return F.dc(2).selectLessonChange.emit(e)})),F.Pb(1,"div",28),F.Pb(2,"span"),F.Ec(3),F.ec(4,"date"),F.ec(5,"date"),F.Ob(),F.Ec(6),F.Ob(),F.Pb(7,"div",29),F.Ec(8),F.Ob(),F.Ob()}if(2&e){var s=n.$implicit,i=F.dc(2);F.Cb("active",s.LessonRef.Id===i.selectedLesson.LessonRef.Id),F.xb(3),F.Hc(" ",F.gc(4,6,s.LessonDateTimeFrom,"HH:mm"),"\u2013",F.gc(5,9,s.LessonDateTimeTo,"HH:mm")," "),F.xb(3),F.Gc(" ",s.StudyClassNumber," "),F.xb(2),F.Fc(s.EventDesignation)}}function je(e,n){if(1&e&&(F.Pb(0,"div",23),F.Pb(1,"div",24),F.Ec(2),F.Ob(),F.Pb(3,"div",25),F.Cc(4,Me,9,12,"div",26),F.Ob(),F.Ob()),2&e){var t=F.dc();F.xb(2),F.Hc(" ",t.selectedLesson.EventDesignation,", ",t.selectedLesson.StudyClassNumber," "),F.xb(2),F.jc("ngForOf",t.lessons)}}function ke(e,n){if(1&e){var t=F.Qb();F.Pb(0,"button",30),F.bc("click",(function(){F.uc(t);var e=F.dc();return null==e.lessonDropdown?null:e.lessonDropdown.toggle()})),F.Pb(1,"i",3),F.Ec(2),F.Ob(),F.Ob()}if(2&e){var s=F.dc();F.xb(2),F.Gc(" ",null!=s.lessonDropdown&&s.lessonDropdown.isOpen()?"keyboard_arrow_up":"keyboard_arrow_down"," ")}}function xe(e,n){if(1&e){var t=F.Qb();F.Pb(0,"button",31),F.bc("click",(function(){F.uc(t);var e=n.$implicit;return F.dc().viewModeChange.emit(e.viewMode)})),F.Pb(1,"i",32),F.Ec(2),F.Ob(),F.Ob()}if(2&e){var s=n.$implicit,i=F.dc();F.Cb("btn-secondary",s.viewMode===i.viewMode)("btn-link",s.viewMode!==i.viewMode)("active",s.viewMode===i.viewMode),F.jc("disabled",!i.selectedLesson),F.xb(2),F.Fc(s.icon)}}var _e=ue.f.prototype._positionMenu;ue.f.prototype._positionMenu=function(){for(var e,n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];var i=_e.apply(this,t);if("lesson-dropdown"===this._anchor.nativeElement.id){var c=this._bodyContainer||this._menu.nativeElement,r=null===(e=c.style.transform)||void 0===e?void 0:e.match(/translate\(([0-9-\.]+)px, ([0-9-\.]+)px\)/);r&&parseFloat(r[1])<0&&(c.style.transform="translate(0px, ".concat(r[2],"px)"))}return i};var Ie,$e=((Ie=function(){function e(){i(this,e),this.presentCount=null,this.absentCount=null,this.unapprovedCount=null,this.search="",this.selectLessonChange=new F.n,this.selectDateChange=new F.n,this.searchChange=new F.n,this.viewModeChange=new F.n,this.viewModeOptions=[{viewMode:G.List,icon:"list"},{viewMode:G.Grid,icon:"view_module"}]}return r(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Ie)},Ie.\u0275cmp=F.Eb({type:Ie,selectors:[["erz-presence-control-header"]],viewQuery:function(e,n){var t;1&e&&F.Jc(ue.f,!0),2&e&&F.sc(t=F.cc())&&(n.lessonDropdown=t.first)},inputs:{selectedLesson:"selectedLesson",lessons:"lessons",presentCount:"presentCount",absentCount:"absentCount",unapprovedCount:"unapprovedCount",viewMode:"viewMode",selectDate:"selectDate",search:"search"},outputs:{selectLessonChange:"selectLessonChange",selectDateChange:"selectDateChange",searchChange:"searchChange",viewModeChange:"viewModeChange"},features:[F.wb([{provide:ue.c,useClass:ue.d},{provide:ue.e,useClass:Ce.a}])],decls:37,vars:16,consts:[[1,"navigation"],[1,"lesson-date"],["type","button",1,"btn","btn-link",3,"click"],[1,"material-icons"],["ngbDatepicker","",1,"lesson-date-input",3,"ngModel","ngModelChange"],["d","ngbDatepicker"],["class","lesson-time",3,"click",4,"ngIf"],["ngbDropdown","","class","lesson-description","container","body","display","dynamic","placement","bottom",4,"ngIf"],["type","button","class","dropdown-caret btn btn-link",3,"click",4,"ngIf"],[1,"states"],[1,"state","present"],[1,"count"],[1,"state","absent"],[1,"state","unapproved"],[1,"search-and-views"],[1,"search","input-group"],[1,"input-group-prepend"],["id","search-addon",1,"input-group-text"],["type","text","aria-describedby","search-addon",1,"form-control",3,"value","disabled","keyup"],[1,"views"],["type","button","class","view btn",3,"disabled","btn-secondary","btn-link","active","click",4,"ngFor","ngForOf"],[1,"lesson-time",3,"click"],[1,"lesson-time-to"],["ngbDropdown","","container","body","display","dynamic","placement","bottom",1,"lesson-description"],["id","lesson-dropdown","ngbDropdownToggle",""],["ngbDropdownMenu","","aria-labelledby","lesson-dropdown"],["ngbDropdownItem","",3,"active","click",4,"ngFor","ngForOf"],["ngbDropdownItem","",3,"click"],[1,"lesson-time-class"],[1,"lesson-designation"],["type","button",1,"dropdown-caret","btn","btn-link",3,"click"],["type","button",1,"view","btn",3,"disabled","click"],[1,"material-icons","align-middle"]],template:function(e,n){if(1&e){var t=F.Qb();F.Pb(0,"div",0),F.Pb(1,"div",1),F.Pb(2,"button",2),F.bc("click",(function(){return F.uc(t),F.tc(6).toggle()})),F.Pb(3,"i",3),F.Ec(4,"calendar_today"),F.Ob(),F.Ob(),F.Pb(5,"input",4,5),F.bc("ngModelChange",(function(e){return n.selectDateChange.emit(e)})),F.Ob(),F.Ob(),F.Cc(7,we,6,8,"div",6),F.Cc(8,je,5,3,"div",7),F.Cc(9,ke,3,1,"button",8),F.Ob(),F.Pb(10,"div",9),F.Pb(11,"div",10),F.Pb(12,"i",3),F.Ec(13,"check_circle"),F.Ob(),F.Pb(14,"span",11),F.Ec(15),F.Ob(),F.Ob(),F.Pb(16,"div",12),F.Pb(17,"i",3),F.Ec(18,"cancel"),F.Ob(),F.Pb(19,"span",11),F.Ec(20),F.Ob(),F.Ob(),F.Pb(21,"div",13),F.Pb(22,"i",3),F.Ec(23,"help"),F.Ob(),F.Pb(24,"span",11),F.Ec(25),F.Ob(),F.Ob(),F.Ob(),F.Pb(26,"div",14),F.Pb(27,"div",15),F.Pb(28,"div",16),F.Pb(29,"span",17),F.Pb(30,"i",3),F.Ec(31,"search"),F.Ob(),F.Ob(),F.Ob(),F.Pb(32,"input",18),F.bc("keyup",(function(e){return n.searchChange.emit(e.target.value)})),F.ec(33,"translate"),F.ec(34,"translate"),F.Ob(),F.Ob(),F.Pb(35,"div",19),F.Cc(36,xe,3,8,"button",20),F.Ob(),F.Ob()}2&e&&(F.xb(5),F.jc("ngModel",n.selectDate),F.xb(2),F.jc("ngIf",n.selectedLesson),F.xb(1),F.jc("ngIf",n.selectedLesson),F.xb(1),F.jc("ngIf",n.lessons.length>0),F.xb(6),F.Fc(null!=n.presentCount?n.presentCount:"?"),F.xb(5),F.Fc(null!=n.absentCount?n.absentCount:"?"),F.xb(5),F.Fc(null!=n.unapprovedCount?n.unapprovedCount:"?"),F.xb(7),F.jc("value",n.search)("disabled",!n.selectedLesson),F.yb("placeholder",F.fc(33,12,"presence-control.header.search-by-name"))("aria-label",F.fc(34,14,"presence-control.header.search")),F.xb(4),F.jc("ngForOf",n.viewModeOptions))},directives:[ue.j,pe.a,pe.h,pe.k,z.m,z.l,ue.f,ue.i,ue.h,ue.g],pipes:[se.c,z.e],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.125rem 1.5rem}.navigation[_ngcontent-%COMP%]{display:-ms-grid;display:grid;grid-template-areas:". date time dropdown-caret" ". description description dropdown-caret";-ms-grid-columns:1fr auto auto 1fr;grid-template-columns:1fr auto auto 1fr}.navigation[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{-ms-grid-row-align:center;align-self:center}.lesson-date[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2;grid-area:date;justify-self:end;display:flex;align-items:center;justify-content:flex-end}.lesson-date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0 .5ch 0 0}.lesson-date[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#33333d;position:relative;top:2px}.lesson-date-input[_ngcontent-%COMP%]{font-weight:600;background:transparent;border:none;width:11ch}.ie11[_nghost-%COMP%]   .lesson-date-input[_ngcontent-%COMP%], .ie11   [_nghost-%COMP%]   .lesson-date-input[_ngcontent-%COMP%]{margin-top:-5px;width:12ch}.lesson-time[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:3;grid-area:time;cursor:pointer}.lesson-time-class[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.lesson-designation[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.lesson-description[_ngcontent-%COMP%]{-ms-grid-row:2;-ms-grid-column:2;-ms-grid-column-span:2;grid-area:description;overflow:hidden;text-align:center;cursor:pointer}.dropdown-toggle[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.dropdown-caret[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-row-span:2;-ms-grid-column:4;grid-area:dropdown-caret;line-height:100%;text-align:left;color:#33333d}.dropdown-menu[_ngcontent-%COMP%]{width:50ch;padding:0;box-shadow:2px 2px 3px -1px rgba(0,0,0,.2)}@media (max-width:800px){.dropdown-menu[_ngcontent-%COMP%]{width:100vw}}.dropdown-item[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #dee2e6}.states[_ngcontent-%COMP%]{margin:1.125rem 0;display:flex;justify-content:center}.state[_ngcontent-%COMP%]{margin-right:7%;display:flex}.state[_ngcontent-%COMP%]:last-child{margin-right:0}@media (min-width:1000px){.state[_ngcontent-%COMP%]{margin-right:6rem}}.state.present[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#28a745}.state.absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#dc3545}.state.unapproved[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ffa814}.state[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{margin-left:.3em;margin-top:1px}.search-and-views[_ngcontent-%COMP%]{padding-top:1.125rem;display:flex;justify-content:space-between;border-top:1px solid #e9ecef}.search[_ngcontent-%COMP%]{flex:auto;max-width:300px;margin-right:1.5rem}.views[_ngcontent-%COMP%]{display:flex}.view[_ngcontent-%COMP%]{padding:.25rem;color:#6c757d}.view.active[_ngcontent-%COMP%]{color:#33333d}@media (max-width:380px){[_nghost-%COMP%]{padding-left:.75rem;padding-right:.75rem}#search-addon[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}}@media (max-width:365px){.lesson-time[_ngcontent-%COMP%]{line-height:1}.lesson-time-to[_ngcontent-%COMP%]{display:block}.dropdown-caret[_ngcontent-%COMP%]{padding-left:0}}']}),Ie),Le=c("jtHE"),Te=c("PT0D"),Se=function(e){return["/presence-control/student",e]};function Ee(e,n){if(1&e&&(F.Lb(0,"erz-avatar",7),F.ec(1,"async")),2&e){var t=F.dc();F.jc("studentId",F.fc(1,3,t.studentId$))("link",F.nc(5,Se,t.entry.lessonPresence.StudentRef.Id))("linkParams",t.profileReturnParams)}}function De(e,n){if(1&e&&(F.Pb(0,"span"),F.Ec(1),F.Ob()),2&e){var t=F.dc(2);F.xb(1),F.Fc(null==t.entry.presenceType?null:t.entry.presenceType.Designation)}}function Ue(e,n){if(1&e){var t=F.Qb();F.Pb(0,"button",8),F.bc("click",(function(){F.uc(t);var e=F.dc();return e.updatePresenceType(e.entry)})),F.Cc(1,De,2,1,"span",9),F.Ob()}if(2&e){var s=F.dc();F.xb(1),F.jc("ngIf",!(null!=s.entry.presenceType&&s.entry.presenceType.IsIncident))}}function Ae(e,n){if(1&e){var t=F.Qb();F.Pb(0,"a",10),F.bc("click",(function(){F.uc(t);var e=F.dc();return e.updateIncident(e.entry)})),F.Pb(1,"i",3),F.Ec(2,"edit"),F.Ob(),F.Pb(3,"span"),F.Ec(4),F.ec(5,"translate"),F.Ob(),F.Ob()}if(2&e){var s=F.dc();F.xb(4),F.Fc(F.fc(5,1,(null==s.entry.presenceType?null:s.entry.presenceType.IsIncident)&&(null==s.entry.presenceType?null:s.entry.presenceType.Designation)||"presence-control.entry.incident"))}}var Re,Fe=((Re=function(){function e(n,t){i(this,e),this.toastr=n,this.translate=t,this.hasUnconfirmedAbsences=!1,this.togglePresenceType=new F.n,this.changeIncident=new F.n,this.studentId$=new Le.a(1)}return r(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(e){e.entry&&this.studentId$.next(e.entry.currentValue.lessonPresence.StudentRef.Id)}},{key:"updatePresenceType",value:function(e){e.canChangePresenceType?this.togglePresenceType.emit(e):this.toastr.warning(this.translate.instant("presence-control.entry.update-warning"))}},{key:"updateIncident",value:function(e){e.canChangeIncident&&this.changeIncident.emit(e)}},{key:"classNames",get:function(){return[this.entry.presenceCategory,this.viewMode].join(" ")}},{key:"isListViewMode",get:function(){return this.viewMode===G.List}}]),e}()).\u0275fac=function(e){return new(e||Re)(F.Kb(te.b),F.Kb(se.d))},Re.\u0275cmp=F.Eb({type:Re,selectors:[["erz-presence-control-entry"]],hostVars:2,hostBindings:function(e,n){2&e&&F.zb(n.classNames)},inputs:{entry:"entry",hasUnconfirmedAbsences:"hasUnconfirmedAbsences",viewMode:"viewMode",profileReturnParams:"profileReturnParams"},outputs:{togglePresenceType:"togglePresenceType",changeIncident:"changeIncident"},features:[F.vb],decls:11,vars:12,consts:[["class","avatar large",3,"studentId","link","linkParams",4,"ngIf"],["type","button","class","presence-category designation btn btn-link",3,"click",4,"ngIf"],["type","button",1,"presence-category","status","btn","btn-link",3,"click"],[1,"material-icons"],[1,"student-name",3,"routerLink","queryParams"],[1,"unconfirmed-absences"],["class","incident btn btn-link",3,"click",4,"ngIf"],[1,"avatar","large",3,"studentId","link","linkParams"],["type","button",1,"presence-category","designation","btn","btn-link",3,"click"],[4,"ngIf"],[1,"incident","btn","btn-link",3,"click"]],template:function(e,n){1&e&&(F.Cc(0,Ee,2,7,"erz-avatar",0),F.Cc(1,Ue,2,1,"button",1),F.Pb(2,"button",2),F.bc("click",(function(){return n.updatePresenceType(n.entry)})),F.Pb(3,"i",3),F.Ec(4),F.Ob(),F.Ob(),F.Pb(5,"a",4),F.Ec(6),F.Pb(7,"span",5),F.Ec(8),F.ec(9,"translate"),F.Ob(),F.Ob(),F.Cc(10,Ae,6,3,"a",6)),2&e&&(F.jc("ngIf",!n.isListViewMode),F.xb(1),F.jc("ngIf",n.entry.showDesignation),F.xb(3),F.Fc(n.entry.presenceCategoryIcon),F.xb(1),F.jc("routerLink",F.nc(10,Se,n.entry.lessonPresence.StudentRef.Id))("queryParams",n.profileReturnParams),F.xb(1),F.Gc(" ",n.entry.lessonPresence.StudentFullName," "),F.xb(2),F.Gc(" ",n.hasUnconfirmedAbsences?F.fc(9,8,"presence-control.entry.unconfirmed-absences"):""," "),F.xb(2),F.jc("ngIf",n.entry.canChangeIncident))},directives:[z.m,a.g,Te.a],pipes:[se.c,z.b],styles:['[_nghost-%COMP%]{padding:3rem 1.5rem;background-color:#fff;display:-ms-grid;display:grid;grid-template-areas:"avatar status designation" "avatar student-name student-name" "avatar incident incident";-ms-grid-columns:-webkit-min-content -webkit-min-content 1fr;-ms-grid-columns:min-content min-content 1fr;grid-template-columns:-webkit-min-content -webkit-min-content 1fr;grid-template-columns:min-content min-content 1fr}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{-ms-grid-row-align:center;align-self:center}.presence-category[_ngcontent-%COMP%]{text-decoration:none}.presence-category[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:relative;top:.1875rem}.absent[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#dc3545}.present[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#28a745}.unapproved[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#ffa814}.designation[_ngcontent-%COMP%], .incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .student-name[_ngcontent-%COMP%], a.incident[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.avatar[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-row-span:3;-ms-grid-column:1;grid-area:avatar;margin-right:2.25rem}.status[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2;grid-area:status}.list[_nghost-%COMP%] > .status[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:3}.status[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2.75rem}.designation[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:3;grid-area:designation;text-align:left;line-height:3.125rem}.student-name[_ngcontent-%COMP%]{-ms-grid-row:2;-ms-grid-column:2;-ms-grid-column-span:2;color:#33333d;grid-area:student-name;display:flex;flex-direction:column}.list[_nghost-%COMP%] > .student-name[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:1;-ms-grid-column-span:1}.unconfirmed-absences[_ngcontent-%COMP%]{color:#dc3545;font-size:1.1rem;line-height:1}.incident[_ngcontent-%COMP%]{-ms-grid-row:3;-ms-grid-column:2;-ms-grid-column-span:2;color:rgba(51,51,61,.5);padding-right:.75rem;grid-area:incident;display:flex}.incident[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}.grid[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .grid[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{-ms-grid-row-align:start;align-self:start;margin-left:-.75rem;margin-top:-.375rem}.grid[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{-ms-grid-row-align:end;align-self:end;margin-left:-.75rem;margin-bottom:-.375rem}.grid[_nghost-%COMP%]   .unconfirmed-absences[_ngcontent-%COMP%]{height:1.1rem}.list[_nghost-%COMP%]{grid-template-areas:"student-name incidentordesignation status";-ms-grid-columns:1fr 2fr -webkit-min-content;-ms-grid-columns:1fr 2fr min-content;grid-template-columns:1fr 2fr -webkit-min-content;grid-template-columns:1fr 2fr min-content;padding:.5rem .5rem .5rem 1rem}.list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2;grid-area:incidentordesignation}.list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%]{text-align:right}.list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{margin-left:-.75rem}@media (max-width:750px){.list[_nghost-%COMP%]{grid-template-areas:"student-name status" "incidentordesignation incidentordesignation";-ms-grid-columns:1fr -webkit-min-content;-ms-grid-columns:1fr min-content;grid-template-columns:1fr -webkit-min-content;grid-template-columns:1fr min-content}.list[_nghost-%COMP%] > .status[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2}.list[_nghost-%COMP%] > .student-name[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:1;-ms-grid-column-span:1}.list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{-ms-grid-row:2;-ms-grid-column:1;-ms-grid-column-span:2}}']}),Re),ze=c("4Kj8"),Ge=function(e){return{returnparams:e}};function He(e,n){if(1&e){var t=F.Qb();F.Pb(0,"erz-presence-control-entry",10),F.bc("togglePresenceType",(function(e){return F.uc(t),F.dc(6).togglePresenceType(e)}))("changeIncident",(function(e){return F.uc(t),F.dc(6).changeIncident(e)})),F.ec(1,"async"),F.ec(2,"async"),F.ec(3,"async"),F.Ob()}if(2&e){var s=n.$implicit,i=F.dc(6);F.jc("entry",s)("hasUnconfirmedAbsences",F.fc(1,4,i.state.hasUnconfirmedAbsences(s)))("viewMode",F.fc(2,6,i.state.viewMode$))("profileReturnParams",F.nc(10,Ge,F.fc(3,8,i.state.queryParamsString$)))}}function Ke(e,n){if(1&e&&(F.Pb(0,"div",8),F.Pb(1,"label",9),F.Ec(2),F.ec(3,"translate"),F.Ob(),F.Pb(4,"div"),F.ec(5,"async"),F.Cc(6,He,4,12,"erz-presence-control-entry",7),F.Ob(),F.Ob()),2&e){var t=F.dc(4).erzLet,s=F.dc();F.xb(2),F.Gc(" ",F.fc(3,5,"presence-control.previously-absent")," "),F.xb(2),F.Ab("entries view-mode-",F.fc(5,7,s.state.viewMode$),""),F.xb(2),F.jc("ngForOf",t.previouslyAbsentEntries)}}function Xe(e,n){if(1&e){var t=F.Qb();F.Pb(0,"erz-presence-control-entry",10),F.bc("togglePresenceType",(function(e){return F.uc(t),F.dc(5).togglePresenceType(e)}))("changeIncident",(function(e){return F.uc(t),F.dc(5).changeIncident(e)})),F.ec(1,"async"),F.ec(2,"async"),F.ec(3,"async"),F.Ob()}if(2&e){var s=n.$implicit,i=F.dc(5);F.jc("entry",s)("hasUnconfirmedAbsences",F.fc(1,4,i.state.hasUnconfirmedAbsences(s)))("viewMode",F.fc(2,6,i.state.viewMode$))("profileReturnParams",F.nc(10,Ge,F.fc(3,8,i.state.queryParamsString$)))}}function Ne(e,n){if(1&e&&(F.Nb(0),F.Cc(1,Ke,7,9,"div",6),F.Pb(2,"div"),F.ec(3,"async"),F.Cc(4,Xe,4,12,"erz-presence-control-entry",7),F.Ob(),F.Mb()),2&e){var t=F.dc(3).erzLet,s=F.dc();F.xb(1),F.jc("ngIf",t.previouslyAbsentEntries.length>0),F.xb(1),F.Ab("default-entries entries view-mode-",F.fc(3,5,s.state.viewMode$),""),F.xb(2),F.jc("ngForOf",t.previouslyPresentEntries)}}function Qe(e,n){1&e&&(F.Pb(0,"p",11),F.Ec(1),F.ec(2,"translate"),F.Ob()),2&e&&(F.xb(1),F.Gc(" ",F.fc(2,1,"presence-control.no-lesson-presences")," "))}function qe(e,n){if(1&e&&(F.Nb(0),F.Cc(1,Ne,5,7,"ng-container",1),F.Cc(2,Qe,3,3,"ng-template",null,5,F.Dc),F.Mb()),2&e){var t=F.tc(3),s=F.dc(2).erzLet;F.xb(1),F.jc("ngIf",s.entries.length>0)("ngIfElse",t)}}function Ve(e,n){1&e&&(F.Pb(0,"p",12),F.Ec(1),F.ec(2,"translate"),F.Ob()),2&e&&(F.xb(1),F.Fc(F.fc(2,1,"presence-control.no-lessons")))}function Be(e,n){if(1&e){var t=F.Qb();F.Nb(0),F.Pb(1,"erz-presence-control-header",3),F.bc("searchChange",(function(e){return F.uc(t),F.dc(2).search$.next(e)}))("viewModeChange",(function(e){return F.uc(t),F.dc(2).state.setViewMode(e)}))("selectDateChange",(function(e){return F.uc(t),F.dc(2).state.setDate(e)}))("selectLessonChange",(function(e){return F.uc(t),F.dc(2).state.setLesson(e)})),F.ec(2,"async"),F.ec(3,"async"),F.ec(4,"async"),F.ec(5,"async"),F.ec(6,"async"),F.ec(7,"async"),F.Ob(),F.Cc(8,qe,4,2,"ng-container",1),F.Cc(9,Ve,3,3,"ng-template",null,4,F.Dc),F.Mb()}if(2&e){var s=F.tc(10),i=F.dc().erzLet,c=F.dc();F.xb(1),F.jc("selectedLesson",i.lesson)("lessons",i.lessons)("presentCount",F.fc(2,10,c.state.presentCount$))("absentCount",F.fc(3,12,c.state.absentCount$))("unapprovedCount",F.fc(4,14,c.state.unapprovedCount$))("viewMode",F.fc(5,16,c.state.viewMode$))("selectDate",F.fc(6,18,c.state.selectedDate$))("search",F.fc(7,20,c.search$)),F.xb(7),F.jc("ngIf",i.lesson)("ngIfElse",s)}}function We(e,n){1&e&&F.Lb(0,"erz-spinner")}function Je(e,n){if(1&e&&(F.Nb(0),F.Cc(1,Be,11,22,"ng-container",1),F.ec(2,"async"),F.Cc(3,We,1,0,"ng-template",null,2,F.Dc),F.Mb()),2&e){var t=F.tc(4),s=F.dc();F.xb(1),F.jc("ngIf",!F.fc(2,2,s.state.loading$))("ngIfElse",t)}}var Ye,Ze,en,nn=function(e,n,t,s,i){return{lesson:e,lessons:n,entries:t,previouslyPresentEntries:s,previouslyAbsentEntries:i}},tn=((Ye=function(){function e(n,t,s,c,r,o){i(this,e),this.state=n,this.lessonPresencesUpdateService=t,this.presenceTypesService=s,this.modalService=c,this.scrollPosition=r,this.route=o,this.search$=new u.a(""),this.entries$=Object(b.a)([this.state.selectedPresenceControlEntries$,this.search$]).pipe(Object(v.a)(Object(k.a)(le.a)),Object(m.a)(1)),this.previouslyPresentEntries$=this.entries$.pipe(Object(v.a)(I)),this.previouslyAbsentEntries$=this.entries$.pipe(Object(v.a)($)),this.destroy$=new d.a}return r(e,[{key:"ngOnInit",value:function(){this.route.queryParams.pipe(Object(l.a)(this.destroy$)).subscribe(this.restoreStateFromParams.bind(this))}},{key:"ngAfterViewInit",value:function(){this.scrollPosition.restore()}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"doTogglePresenceType",value:function(e,n){var t=this;this.state.getNextPresenceType(e).subscribe((function(s){return t.lessonPresencesUpdateService.updatePresenceTypes(n||[e.lessonPresence],s?s.Id:null)}))}},{key:"togglePresenceType",value:function(e){var n=this;this.state.getBlockLessonPresences(e).pipe(Object(y.a)(1)).subscribe((function(t){if(1===t.length)n.doTogglePresenceType(e);else{var s=n.modalService.open(fe);s.componentInstance.entry=e,s.componentInstance.blockLessonPresences=t,s.result.then((function(t){t&&n.doTogglePresenceType(e,t)}),(function(){}))}}))}},{key:"updateIncident",value:function(e,n){this.lessonPresencesUpdateService.updatePresenceTypes([e.lessonPresence],n)}},{key:"changeIncident",value:function(e){var n=this;this.presenceTypesService.incidentTypes$.subscribe((function(t){var s=n.modalService.open(Pe);s.componentInstance.incident=t.find((function(n){var t;return n.Id===(null===(t=e.presenceType)||void 0===t?void 0:t.Id)}))||null,s.componentInstance.incidentTypes=t,s.result.then((function(t){n.updateIncident(e,(null==t?void 0:t.Id)||null)}),(function(){}))}))}},{key:"restoreStateFromParams",value:function(e){var n=this;e.date&&this.state.setDate(Object(me.c)(e.date));var t=Number(e.lesson);t&&this.state.lessons$.pipe(Object(y.a)(1)).subscribe((function(e){var s=e.find((function(e){return e.LessonRef.Id===t}));s&&n.state.setLesson(s)})),e.viewMode&&H.includes(e.viewMode)&&this.state.setViewMode(e.viewMode)}}]),e}()).\u0275fac=function(e){return new(e||Ye)(F.Kb(K),F.Kb(ce),F.Kb(j.a),F.Kb(ue.k),F.Kb(he.a),F.Kb(a.a))},Ye.\u0275cmp=F.Eb({type:Ye,selectors:[["erz-presence-control-list"]],decls:6,vars:17,consts:[[4,"erzLet"],[4,"ngIf","ngIfElse"],["loading",""],[3,"selectedLesson","lessons","presentCount","absentCount","unapprovedCount","viewMode","selectDate","search","searchChange","viewModeChange","selectDateChange","selectLessonChange"],["noLessons",""],["noLessonPresences",""],["class","previously-absent-entries pt-1 px-2 pb-3",4,"ngIf"],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident",4,"ngFor","ngForOf"],[1,"previously-absent-entries","pt-1","px-2","pb-3"],[1,"mb-1"],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident"],[1,"mt-3","pl-3"],[1,"mt-3","px-3"]],template:function(e,n){1&e&&(F.Cc(0,Je,5,4,"ng-container",0),F.ec(1,"async"),F.ec(2,"async"),F.ec(3,"async"),F.ec(4,"async"),F.ec(5,"async")),2&e&&F.jc("erzLet",F.rc(11,nn,F.fc(1,1,n.state.selectedLesson$),F.fc(2,3,n.state.lessons$),F.fc(3,5,n.entries$),F.fc(4,7,n.previouslyPresentEntries$),F.fc(5,9,n.previouslyAbsentEntries$)))},directives:[Oe.a,z.m,$e,z.l,Fe,ze.a],pipes:[z.b,se.c],styles:["erz-presence-control-entry[_ngcontent-%COMP%]{border-bottom:1px solid #e9ecef}.previously-absent-entries[_ngcontent-%COMP%]{background-color:#fae3e5}.previously-absent-entries[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{color:#dc3545;padding-left:.5rem}.previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%]{background-color:#fff}.previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%] > .absent.list[_ngcontent-%COMP%], .previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%] > .present.list[_ngcontent-%COMP%]{padding:0 0 0 .5rem}@media only screen and (max-device-width:800px),only screen and (max-width:800px){.previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%] > .absent.grid[_ngcontent-%COMP%], .previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%] > .present.grid[_ngcontent-%COMP%]{padding-right:.5rem;padding-left:.5rem}}.entries.view-mode-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}@media (min-width:400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;border-right:1px solid #e9ecef}}@media (min-width:800px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:50%;border-right:1px solid #e9ecef}}@media (min-width:1200px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:33.33333333%;border-right:1px solid #e9ecef}}@media (min-width:1600px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:25%;border-right:1px solid #e9ecef}}@media (min-width:2000px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:20%;border-right:1px solid #e9ecef}}@media (min-width:2400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:16.66666667%;border-right:1px solid #e9ecef}}"],changeDetection:0}),Ye),sn=c("hH5/"),cn=[{path:"",component:de,children:[{path:"",component:tn,data:{restoreScrollPositionFrom:["/presence-control/student/:id"]}},{path:"student/:id",children:[{path:"",component:c("ccj6").a},{path:"confirm",component:sn.a}]}]}],rn=((Ze=function e(){i(this,e)}).\u0275mod=F.Ib({type:Ze}),Ze.\u0275inj=F.Hb({factory:function(e){return new(e||Ze)},imports:[[a.h.forChild(cn)],a.h]}),Ze),on=c("0HM3"),an=((en=function e(){i(this,e)}).\u0275mod=F.Ib({type:en}),en.\u0275inj=F.Hb({factory:function(e){return new(e||en)},providers:[{provide:on.a,useValue:"/presence-control"}],imports:[[o.a,rn]]}),en)}}])}();