(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"2TIA":function(e,n,t){"use strict";t.r(n),t.d(n,"PresenceControlModule",(function(){return qe}));var s=t("PCNd"),c=t("tyNb"),i=t("XNiG"),r=t("1G5W"),o=t("2Vo4"),a=t("VRyK"),d=t("itXk"),l=t("PqYM"),p=t("/uUt"),b=t("eIep"),g=t("UXun"),u=t("lJxs"),h=t("IzEk"),m=t("Muja"),f=t("BeL+"),P=t("sWYD"),O=t("CCnw"),y=t("CqUA"),v=t("KJh6"),C=t("eB9A"),w=t("BzUC");function M(e){return n=>n.reduce((n,t)=>n+(t.presenceCategory===e?1:0),0)}function _(e){return e.filter(e=>!e.lessonPresence.WasAbsentInPrecedingLesson)}function x(e){return e.filter(e=>e.lessonPresence.WasAbsentInPrecedingLesson)}var j=t("vlqf"),I=t("Xr/R"),$=t("G6Tw"),L=t("jIYg"),k=t("v6cN"),T=t("AEFh"),E=t("fXoL"),S=t("ofXK"),D=function(e){return e.Grid="grid",e.List="list",e}({});const U=Object.keys(D).map(e=>D[e]);let R=(()=>{class e{constructor(e,n,t,s,c,l){this.lessonPresencesService=e,this.presenceTypesService=n,this.dropDownItemsService=t,this.loadingService=s,this.settings=c,this.location=l,this.selectedDateSubject$=new o.a(new Date),this.selectLesson$=new i.a,this.viewModeSubject$=new o.a(D.Grid),this.updateLessonPresences$=new i.a,this.lessonPresences$=Object(a.a)(this.selectedDateSubject$.pipe(Object(p.a)(m.a),Object(b.a)(this.loadLessonPresencesByDate.bind(this))),this.updateLessonPresences$).pipe(Object(g.a)(1)),this.presenceTypes$=this.loadPresenceTypes().pipe(Object(g.a)(1)),this.lessons$=this.lessonPresences$.pipe(Object(u.a)(w.a),Object(g.a)(1)),this.currentLesson$=this.lessons$.pipe(Object(u.a)(w.b),Object(p.a)(w.e)),this.studentIdsWithUnconfirmedAbsences$=this.selectedDateSubject$.pipe(Object(b.a)(()=>this.loadStudentIdsWithUnconfirmedAbsences()),Object(g.a)(1)),this.loading$=this.loadingService.loading$,this.selectedLesson$=Object(a.a)(this.currentLesson$,this.selectLesson$).pipe(Object(g.a)(1)),this.absenceConfirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(Object(g.a)(1)),this.selectedPresenceControlEntries$=Object(d.a)([this.selectedLesson$,this.lessonPresences$,this.presenceTypes$,this.absenceConfirmationStates$]).pipe(Object(u.a)(Object(C.a)(w.c)),Object(g.a)(1)),this.presentCount$=this.selectedPresenceControlEntries$.pipe(Object(u.a)(M("present"))),this.absentCount$=this.selectedPresenceControlEntries$.pipe(Object(u.a)(M("absent"))),this.unapprovedCount$=this.selectedPresenceControlEntries$.pipe(Object(u.a)(M("unapproved"))),this.viewMode$=this.viewModeSubject$.asObservable(),this.selectedDate$=this.selectedDateSubject$.asObservable(),this.queryParams$=Object(d.a)([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(Object(u.a)(Object(C.a)(this.buildQueryParams.bind(this)))),this.queryParamsString$=Object(d.a)([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(Object(u.a)(Object(C.a)(this.buildQueryParams.bind(this))),Object(u.a)(T.b)),this.destroy$=new i.a,this.queryParamsString$.pipe(Object(r.a)(this.destroy$)).subscribe(e=>{this.location.replaceState("/presence-control",e),this.confirmBackLinkParams={returnparams:e}})}ngOnDestroy(){this.destroy$.next()}setDate(e){this.selectedDateSubject$.next(e)}setLesson(e){this.selectLesson$.next(e)}setViewMode(e){this.viewModeSubject$.next(e)}updateLessonPresencesTypes(e){Object(d.a)([this.lessonPresences$.pipe(Object(h.a)(1)),this.presenceTypes$.pipe(Object(h.a)(1))]).pipe(Object(u.a)(([n,t])=>function(e,n,t,s){return e.map(e=>{const c=n.find(n=>{return(t=n.presence).LessonRef.Id===(s=e).LessonRef.Id&&t.StudentRef.Id===s.StudentRef.Id;var t,s});if(c){let n;return n=!c.newPresenceTypeId&&e.Comment?t.find(e=>e.IsComment)||null:t.find(e=>e.Id===c.newPresenceTypeId)||null,Object.assign(Object.assign({},e),{TypeRef:(i=n,{Id:i?i.Id:null,HRef:null}),Date:null,Type:n?n.Designation:null,ConfirmationStateId:Object(j.b)(n,s)})}var i;return e})}(n,e,t,this.settings))).subscribe(e=>this.updateLessonPresences$.next(e))}getNextPresenceType(e){return this.presenceTypes$.pipe(Object(h.a)(1),Object(u.a)(n=>e.getNextPresenceType(n)))}getPresenceControlEntry(e,n){return this.selectedPresenceControlEntries$.pipe(Object(h.a)(1),Object(u.a)(t=>t.find(t=>t.lessonPresence.StudentRef.Id===e&&t.lessonPresence.LessonRef.Id===n)||null))}hasUnconfirmedAbsences(e){return this.studentIdsWithUnconfirmedAbsences$.pipe(Object(u.a)(n=>n.includes(e.lessonPresence.StudentRef.Id)))}getBlockLessonPresences(e){return Object(d.a)([this.lessonPresences$.pipe(Object(h.a)(1)),this.presenceTypes$.pipe(Object(h.a)(1))]).pipe(Object(u.a)(([n,t])=>n.filter(n=>n.EventRef.Id===e.lessonPresence.EventRef.Id&&n.StudentRef.Id===e.lessonPresence.StudentRef.Id&&Object(j.a)(n,t.find(e=>e.Id===n.TypeRef.Id)||null,this.settings)).sort((e,n)=>e.LessonDateTimeFrom>n.LessonDateTimeFrom?1:-1)))}loadLessonPresencesByDate(e){return this.loadingService.load(function(e){return Object(L.a)(1,arguments),Object($.a)(e,Date.now())}(e)?this.lessonPresencesService.getListForToday():this.lessonPresencesService.getListByDate(e))}loadPresenceTypes(){return this.loadingService.load(this.presenceTypesService.presenceTypes$)}loadStudentIdsWithUnconfirmedAbsences(){return Object(l.a)(0,this.settings.unconfirmedAbsencesRefreshTime||void 0).pipe(Object(b.a)(()=>this.lessonPresencesService.getListOfUnconfirmed()),Object(u.a)(e=>Object(f.a)(e.map(e=>e.StudentRef.Id))))}buildQueryParams(e,n,t){const s={date:Object(P.a)(e,"yyyy-MM-dd"),viewMode:t};return n&&(s.lesson=String(n.LessonRef.Id)),s}}return e.\u0275fac=function(n){return new(n||e)(E.Xb(O.a),E.Xb(v.a),E.Xb(k.a),E.Xb(y.a),E.Xb(I.a),E.Xb(S.i))},e.\u0275prov=E.Gb({token:e,factory:e.\u0275fac}),e})();var A=t("LRne"),F=t("Kqap"),z=t("w1tV"),G=t("Kj3r"),H=t("pLZG"),K=t("bOdf"),X=t("CqXF"),N=t("JIr8"),Q=t("PduT"),q=t("8teX"),V=t("K+0v"),B=t("LpL1"),W=t("5eHb"),J=t("sYmb"),Y=function(e){return e.AddUpdateAction="ADD",e.RemoveUpdateAction="REMOVE",e}({});let Z=(()=>{class e{constructor(e,n,t,s,c){this.toastr=e,this.translate=n,this.restService=t,this.presenceTypesService=s,this.settings=c,this.destroy$=new i.a,this.action$=new i.a,this.pendingUpdates$=this.action$.pipe(Object(F.a)(this.reduceUpdates.bind(this),[]),Object(z.a)()),this.revertUpdates$=new i.a,this.performUpdates$=this.pendingUpdates$.pipe(Object(G.a)(3e3),Object(H.a)(Object(V.d)(q.b)),Object(K.a)(this.performUpdates.bind(this))),this.stateUpdates$=Object(a.a)(this.pendingUpdates$,this.revertUpdates$).pipe(Object(G.a)(20),Object(H.a)(Object(V.d)(q.b))),this.performUpdates$.pipe(Object(r.a)(this.destroy$)).subscribe()}ngOnDestroy(){this.destroy$.next()}updatePresenceTypes(e,n=null){e.forEach(e=>this.dispatchAddUpdate(e,n))}performUpdates(e){const n=this.groupUpdates(e);return Object(d.a)(Object.keys(n).reduce((e,t)=>{const s=n[t];return Object.keys(s).forEach(n=>{e.push(this.performUpdateForGroup(s[n]))}),e},[])).pipe(Object(X.a)(n))}performUpdateForGroup(e){return e.forEach(e=>this.dispatchRemoveUpdate(e.presence)),this.performLessonPresencesUpdatesByIds(e[0].presence.LessonRef.Id,e.map(e=>e.presence.StudentRef.Id),e[0].newPresenceTypeId).pipe(Object(N.a)(n=>this.revertUpdatesAfterError(e,n)))}performLessonPresencesUpdatesByIds(e,n,t=null){return t?(t?this.presenceTypesService.getPresenceType(t):Object(A.a)(null)).pipe(Object(b.a)(t=>this.restService.editLessonPresences([e],n,null==t?void 0:t.Id,Object(j.b)(t,this.settings)||void 0,Object(Q.b)({disableErrorHandling:!0})))):this.restService.removeLessonPresences([e],n,Object(Q.b)({disableErrorHandling:!0}))}revertUpdatesAfterError(e,n){return console.error("Bulk-update of lesson presences failed"),console.error(n),this.toastr.error(this.translate.instant("shared.lesson-presences-update.error")),this.revertUpdates$.next(e.map(e=>Object.assign(Object.assign({},e),{newPresenceTypeId:e.presence.TypeRef.Id}))),Object(A.a)(void 0)}groupUpdates(e){return e.reduce((e,n)=>{const t=String(n.newPresenceTypeId&&n.newPresenceTypeId);return e[t]||(e[t]={}),Array.isArray(e[t][n.presence.LessonRef.Id])||(e[t][n.presence.LessonRef.Id]=[]),e[t][n.presence.LessonRef.Id].push(n),e},{})}reduceUpdates(e,n){switch(n.type){case Y.AddUpdateAction:const{presence:t,newPresenceTypeId:s}=n.payload,c=e.findIndex(ee(t));return-1===c?[...e,{presence:t,newPresenceTypeId:s}]:[...e.slice(0,c),{presence:e[c].presence,newPresenceTypeId:s},...e.slice(c+1)];case Y.RemoveUpdateAction:return e.filter(Object(V.d)(ee(n.payload)));default:return e}}dispatchAddUpdate(e,n){this.action$.next({type:Y.AddUpdateAction,payload:{presence:e,newPresenceTypeId:n}})}dispatchRemoveUpdate(e){this.action$.next({type:Y.RemoveUpdateAction,payload:e})}}return e.\u0275fac=function(n){return new(n||e)(E.Xb(W.b),E.Xb(J.d),E.Xb(B.a),E.Xb(v.a),E.Xb(I.a))},e.\u0275prov=E.Gb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function ee(e){return n=>n.presence.LessonRef.Id===e.LessonRef.Id&&n.presence.StudentRef.Id===e.StudentRef.Id}var ne=t("qUtt");let te=(()=>{class e{constructor(e,n){this.state=e,this.lessonPresencesUpdateService=n,this.destroy$=new i.a}ngOnInit(){this.lessonPresencesUpdateService.stateUpdates$.pipe(Object(r.a)(this.destroy$)).subscribe(e=>this.state.updateLessonPresencesTypes(e))}ngOnDestroy(){this.destroy$.next()}}return e.\u0275fac=function(n){return new(n||e)(E.Kb(R),E.Kb(Z))},e.\u0275cmp=E.Eb({type:e,selectors:[["erz-presence-control"]],features:[E.wb([R,{provide:ne.a,useExisting:R}])],decls:1,vars:0,template:function(e,n){1&e&&E.Lb(0,"router-outlet")},directives:[c.i],styles:[""],changeDetection:0}),e})();var se=t("jiSq"),ce=(t("RYjX"),t("1kSV")),ie=t("3Pt+");function re(e,n){if(1&e&&(E.Pb(0,"div",5),E.Pb(1,"input",6),E.bc("change",(function(){const e=n.$implicit;return e.selected=!e.selected})),E.Ob(),E.Pb(2,"label",7),E.Ec(3),E.ec(4,"date"),E.ec(5,"date"),E.Ob(),E.Ob()),2&e){const e=n.$implicit,t=n.index;E.xb(1),E.lc("id","lesson-presence-",t,""),E.jc("checked",e.selected),E.xb(1),E.lc("for","lesson-presence-",t,""),E.xb(1),E.Hc(" ",E.gc(4,5,e.lessonPresence.LessonDateTimeFrom,"HH:mm"),"\u2013",E.gc(5,8,e.lessonPresence.LessonDateTimeTo,"HH:mm"),"")}}let oe=(()=>{class e{constructor(e){this.activeModal=e,this.lessonPresenceOptions=[]}ngOnInit(){this.lessonPresenceOptions=this.blockLessonPresences.map(e=>this.createLessonPresenceOption(e))}getSelectedLessonPresences(){return this.lessonPresenceOptions.filter(e=>e.selected).map(e=>e.lessonPresence)}createLessonPresenceOption(e){return{lessonPresence:e,selected:!0}}}return e.\u0275fac=function(n){return new(n||e)(E.Kb(ce.b))},e.\u0275cmp=E.Eb({type:e,selectors:[["erz-presence-control-dialog-component"]],inputs:{entry:"entry",blockLessonPresences:"blockLessonPresences"},decls:13,vars:11,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"form-group","form-check"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label",3,"for"]],template:function(e,n){1&e&&(E.Pb(0,"div",0),E.Pb(1,"p"),E.Ec(2),E.ec(3,"translate"),E.Ob(),E.Pb(4,"form"),E.Cc(5,re,6,11,"div",1),E.Ob(),E.Ob(),E.Pb(6,"div",2),E.Pb(7,"button",3),E.bc("click",(function(){return n.activeModal.close()})),E.Ec(8),E.ec(9,"translate"),E.Ob(),E.Pb(10,"button",4),E.bc("click",(function(){return n.activeModal.close(n.getSelectedLessonPresences())})),E.Ec(11),E.ec(12,"translate"),E.Ob(),E.Ob()),2&e&&(E.xb(2),E.Gc(" ",E.fc(3,5,"presence-control.dialog.text")," "),E.xb(3),E.jc("ngForOf",n.lessonPresenceOptions),E.xb(3),E.Gc(" ",E.fc(9,7,"presence-control.dialog.cancel")," "),E.xb(2),E.jc("disabled",0===n.getSelectedLessonPresences().length),E.xb(1),E.Gc(" ",E.fc(12,9,"presence-control.dialog.save")," "))},directives:[ie.r,ie.i,ie.j,S.l],pipes:[J.c,S.e],encapsulation:2}),e})();var ae=t("yl8S"),de=t("KCaQ");function le(e,n){if(1&e){const e=E.Qb();E.Pb(0,"div",5),E.Pb(1,"input",6),E.bc("change",(function(){E.uc(e);const t=n.$implicit;return E.dc().onSelectionChange(t)})),E.Ob(),E.Pb(2,"label",7),E.Ec(3),E.Ob(),E.Ob()}if(2&e){const e=n.$implicit,t=n.index,s=E.dc();E.xb(1),E.lc("id","incident-",t,""),E.jc("checked",e.id===s.selected.id)("value",e.id),E.xb(1),E.lc("for","incident-",t,""),E.xb(1),E.Gc(" ",e.label," ")}}let pe=(()=>{class e{constructor(e,n){this.activeModal=e,this.translate=n,this.incidentOptions=[]}ngOnInit(){const e=this.createIncidentOption();this.incidentOptions=this.incidentTypes.map(e=>this.createIncidentOption(e)),this.incidentOptions.unshift(e),this.selected=this.incidentOptions.find(e=>{var n;return e.id===(null===(n=this.incident)||void 0===n?void 0:n.Id)})||e}createIncidentOption(e){return{id:e?e.Id:null,label:e?e.Designation:this.translate.instant("presence-control.incident.no-incident")}}onSelectionChange(e){this.selected=e}getSelectedIncident(){return this.incidentTypes.find(e=>{var n;return e.Id===(null===(n=this.selected)||void 0===n?void 0:n.id)})||null}}return e.\u0275fac=function(n){return new(n||e)(E.Kb(ce.b),E.Kb(J.d))},e.\u0275cmp=E.Eb({type:e,selectors:[["erz-presence-control-incident"]],inputs:{incident:"incident",incidentTypes:"incidentTypes"},decls:13,vars:10,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"form-group","form-check"],["type","radio","name","incident",1,"form-check-input",3,"id","checked","value","change"],[1,"form-check-label",3,"for"]],template:function(e,n){1&e&&(E.Pb(0,"div",0),E.Pb(1,"p"),E.Ec(2),E.ec(3,"translate"),E.Ob(),E.Pb(4,"form"),E.Cc(5,le,4,5,"div",1),E.Ob(),E.Ob(),E.Pb(6,"div",2),E.Pb(7,"button",3),E.bc("click",(function(){return n.activeModal.dismiss()})),E.Ec(8),E.ec(9,"translate"),E.Ob(),E.Pb(10,"button",4),E.bc("click",(function(){return n.activeModal.close(n.getSelectedIncident())})),E.Ec(11),E.ec(12,"translate"),E.Ob(),E.Ob()),2&e&&(E.xb(2),E.Gc(" ",E.fc(3,4,"presence-control.incident.text")," "),E.xb(3),E.jc("ngForOf",n.incidentOptions),E.xb(3),E.Gc(" ",E.fc(9,6,"presence-control.incident.cancel")," "),E.xb(3),E.Gc(" ",E.fc(12,8,"presence-control.incident.save")," "))},directives:[ie.r,ie.i,ie.j,S.l],pipes:[J.c],styles:["form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-bottom:.75rem;border-bottom:1px solid #e9ecef}"]}),e})();var be=t("EOpz"),ge=t("YDIV");function ue(e,n){if(1&e){const e=E.Qb();E.Pb(0,"div",21),E.bc("click",(function(){return E.uc(e),E.dc().lessonDropdown.toggle()})),E.Ec(1),E.ec(2,"date"),E.Pb(3,"span",22),E.Ec(4),E.ec(5,"date"),E.Ob(),E.Ob()}if(2&e){const e=E.dc();E.xb(1),E.Gc(" ",E.gc(2,2,e.selectedLesson.LessonDateTimeFrom,"HH:mm"),"\u2013"),E.xb(3),E.Fc(E.gc(5,5,e.selectedLesson.LessonDateTimeTo,"HH:mm"))}}function he(e,n){if(1&e){const e=E.Qb();E.Pb(0,"div",27),E.bc("click",(function(){E.uc(e);const t=n.$implicit;return E.dc(2).selectLessonChange.emit(t)})),E.Pb(1,"div",28),E.Pb(2,"span"),E.Ec(3),E.ec(4,"date"),E.ec(5,"date"),E.Ob(),E.Ec(6),E.Ob(),E.Pb(7,"div",29),E.Ec(8),E.Ob(),E.Ob()}if(2&e){const e=n.$implicit,t=E.dc(2);E.Cb("active",e.LessonRef.Id===t.selectedLesson.LessonRef.Id),E.xb(3),E.Hc(" ",E.gc(4,6,e.LessonDateTimeFrom,"HH:mm"),"\u2013",E.gc(5,9,e.LessonDateTimeTo,"HH:mm")," "),E.xb(3),E.Gc(" ",e.StudyClassNumber," "),E.xb(2),E.Fc(e.EventDesignation)}}function me(e,n){if(1&e&&(E.Pb(0,"div",23),E.Pb(1,"div",24),E.Ec(2),E.Ob(),E.Pb(3,"div",25),E.Cc(4,he,9,12,"div",26),E.Ob(),E.Ob()),2&e){const e=E.dc();E.xb(2),E.Hc(" ",e.selectedLesson.EventDesignation,", ",e.selectedLesson.StudyClassNumber," "),E.xb(2),E.jc("ngForOf",e.lessons)}}function fe(e,n){if(1&e){const e=E.Qb();E.Pb(0,"button",30),E.bc("click",(function(){E.uc(e);const n=E.dc();return null==n.lessonDropdown?null:n.lessonDropdown.toggle()})),E.Pb(1,"i",3),E.Ec(2),E.Ob(),E.Ob()}if(2&e){const e=E.dc();E.xb(2),E.Gc(" ",null!=e.lessonDropdown&&e.lessonDropdown.isOpen()?"keyboard_arrow_up":"keyboard_arrow_down"," ")}}function Pe(e,n){if(1&e){const e=E.Qb();E.Pb(0,"button",31),E.bc("click",(function(){E.uc(e);const t=n.$implicit;return E.dc().viewModeChange.emit(t.viewMode)})),E.Pb(1,"i",32),E.Ec(2),E.Ob(),E.Ob()}if(2&e){const e=n.$implicit,t=E.dc();E.Cb("btn-secondary",e.viewMode===t.viewMode)("btn-link",e.viewMode!==t.viewMode)("active",e.viewMode===t.viewMode),E.jc("disabled",!t.selectedLesson),E.xb(2),E.Fc(e.icon)}}const Oe=ce.f.prototype._positionMenu;ce.f.prototype._positionMenu=function(...e){var n;const t=Oe.apply(this,e);if("lesson-dropdown"===this._anchor.nativeElement.id){const e=this._bodyContainer||this._menu.nativeElement,t=null===(n=e.style.transform)||void 0===n?void 0:n.match(/translate\(([0-9-\.]+)px, ([0-9-\.]+)px\)/);t&&parseFloat(t[1])<0&&(e.style.transform=`translate(0px, ${t[2]}px)`)}return t};let ye=(()=>{class e{constructor(){this.presentCount=null,this.absentCount=null,this.unapprovedCount=null,this.search="",this.selectLessonChange=new E.n,this.selectDateChange=new E.n,this.searchChange=new E.n,this.viewModeChange=new E.n,this.viewModeOptions=[{viewMode:D.List,icon:"list"},{viewMode:D.Grid,icon:"view_module"}]}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=E.Eb({type:e,selectors:[["erz-presence-control-header"]],viewQuery:function(e,n){var t;1&e&&E.Jc(ce.f,!0),2&e&&E.sc(t=E.cc())&&(n.lessonDropdown=t.first)},inputs:{selectedLesson:"selectedLesson",lessons:"lessons",presentCount:"presentCount",absentCount:"absentCount",unapprovedCount:"unapprovedCount",viewMode:"viewMode",selectDate:"selectDate",search:"search"},outputs:{selectLessonChange:"selectLessonChange",selectDateChange:"selectDateChange",searchChange:"searchChange",viewModeChange:"viewModeChange"},features:[E.wb([{provide:ce.c,useClass:ce.d},{provide:ce.e,useClass:ge.a}])],decls:37,vars:16,consts:[[1,"navigation"],[1,"lesson-date"],["type","button",1,"btn","btn-link",3,"click"],[1,"material-icons"],["ngbDatepicker","",1,"lesson-date-input",3,"ngModel","ngModelChange"],["d","ngbDatepicker"],["class","lesson-time",3,"click",4,"ngIf"],["ngbDropdown","","class","lesson-description","container","body","display","dynamic","placement","bottom",4,"ngIf"],["type","button","class","dropdown-caret btn btn-link",3,"click",4,"ngIf"],[1,"states"],[1,"state","present"],[1,"count"],[1,"state","absent"],[1,"state","unapproved"],[1,"search-and-views"],[1,"search","input-group"],[1,"input-group-prepend"],["id","search-addon",1,"input-group-text"],["type","text","aria-describedby","search-addon",1,"form-control",3,"value","disabled","keyup"],[1,"views"],["type","button","class","view btn",3,"disabled","btn-secondary","btn-link","active","click",4,"ngFor","ngForOf"],[1,"lesson-time",3,"click"],[1,"lesson-time-to"],["ngbDropdown","","container","body","display","dynamic","placement","bottom",1,"lesson-description"],["id","lesson-dropdown","ngbDropdownToggle",""],["ngbDropdownMenu","","aria-labelledby","lesson-dropdown"],["ngbDropdownItem","",3,"active","click",4,"ngFor","ngForOf"],["ngbDropdownItem","",3,"click"],[1,"lesson-time-class"],[1,"lesson-designation"],["type","button",1,"dropdown-caret","btn","btn-link",3,"click"],["type","button",1,"view","btn",3,"disabled","click"],[1,"material-icons","align-middle"]],template:function(e,n){if(1&e){const e=E.Qb();E.Pb(0,"div",0),E.Pb(1,"div",1),E.Pb(2,"button",2),E.bc("click",(function(){return E.uc(e),E.tc(6).toggle()})),E.Pb(3,"i",3),E.Ec(4,"calendar_today"),E.Ob(),E.Ob(),E.Pb(5,"input",4,5),E.bc("ngModelChange",(function(e){return n.selectDateChange.emit(e)})),E.Ob(),E.Ob(),E.Cc(7,ue,6,8,"div",6),E.Cc(8,me,5,3,"div",7),E.Cc(9,fe,3,1,"button",8),E.Ob(),E.Pb(10,"div",9),E.Pb(11,"div",10),E.Pb(12,"i",3),E.Ec(13,"check_circle"),E.Ob(),E.Pb(14,"span",11),E.Ec(15),E.Ob(),E.Ob(),E.Pb(16,"div",12),E.Pb(17,"i",3),E.Ec(18,"cancel"),E.Ob(),E.Pb(19,"span",11),E.Ec(20),E.Ob(),E.Ob(),E.Pb(21,"div",13),E.Pb(22,"i",3),E.Ec(23,"help"),E.Ob(),E.Pb(24,"span",11),E.Ec(25),E.Ob(),E.Ob(),E.Ob(),E.Pb(26,"div",14),E.Pb(27,"div",15),E.Pb(28,"div",16),E.Pb(29,"span",17),E.Pb(30,"i",3),E.Ec(31,"search"),E.Ob(),E.Ob(),E.Ob(),E.Pb(32,"input",18),E.bc("keyup",(function(e){return n.searchChange.emit(e.target.value)})),E.ec(33,"translate"),E.ec(34,"translate"),E.Ob(),E.Ob(),E.Pb(35,"div",19),E.Cc(36,Pe,3,8,"button",20),E.Ob(),E.Ob()}2&e&&(E.xb(5),E.jc("ngModel",n.selectDate),E.xb(2),E.jc("ngIf",n.selectedLesson),E.xb(1),E.jc("ngIf",n.selectedLesson),E.xb(1),E.jc("ngIf",n.lessons.length>0),E.xb(6),E.Fc(null!=n.presentCount?n.presentCount:"?"),E.xb(5),E.Fc(null!=n.absentCount?n.absentCount:"?"),E.xb(5),E.Fc(null!=n.unapprovedCount?n.unapprovedCount:"?"),E.xb(7),E.jc("value",n.search)("disabled",!n.selectedLesson),E.yb("placeholder",E.fc(33,12,"presence-control.header.search-by-name"))("aria-label",E.fc(34,14,"presence-control.header.search")),E.xb(4),E.jc("ngForOf",n.viewModeOptions))},directives:[ce.j,ie.a,ie.h,ie.k,S.m,S.l,ce.f,ce.i,ce.h,ce.g],pipes:[J.c,S.e],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.125rem 1.5rem}.navigation[_ngcontent-%COMP%]{display:-ms-grid;display:grid;grid-template-areas:". date time dropdown-caret" ". description description dropdown-caret";-ms-grid-columns:1fr auto auto 1fr;grid-template-columns:1fr auto auto 1fr}.navigation[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{-ms-grid-row-align:center;align-self:center}.lesson-date[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2;grid-area:date;justify-self:end;display:flex;align-items:center;justify-content:flex-end}.lesson-date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0 .5ch 0 0}.lesson-date[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#33333d;position:relative;top:2px}.lesson-date-input[_ngcontent-%COMP%]{font-weight:600;background:transparent;border:none;width:11ch}.ie11[_nghost-%COMP%]   .lesson-date-input[_ngcontent-%COMP%], .ie11   [_nghost-%COMP%]   .lesson-date-input[_ngcontent-%COMP%]{margin-top:-5px;width:12ch}.lesson-time[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:3;grid-area:time;cursor:pointer}.lesson-time-class[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.lesson-designation[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.lesson-description[_ngcontent-%COMP%]{-ms-grid-row:2;-ms-grid-column:2;-ms-grid-column-span:2;grid-area:description;overflow:hidden;text-align:center;cursor:pointer}.dropdown-toggle[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.dropdown-caret[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-row-span:2;-ms-grid-column:4;grid-area:dropdown-caret;line-height:100%;text-align:left;color:#33333d}.dropdown-menu[_ngcontent-%COMP%]{width:50ch;padding:0;box-shadow:2px 2px 3px -1px rgba(0,0,0,.2)}@media (max-width:800px){.dropdown-menu[_ngcontent-%COMP%]{width:100vw}}.dropdown-item[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #dee2e6}.states[_ngcontent-%COMP%]{margin:1.125rem 0;display:flex;justify-content:center}.state[_ngcontent-%COMP%]{margin-right:7%;display:flex}.state[_ngcontent-%COMP%]:last-child{margin-right:0}@media (min-width:1000px){.state[_ngcontent-%COMP%]{margin-right:6rem}}.state.present[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#28a745}.state.absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#dc3545}.state.unapproved[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ffa814}.state[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{margin-left:.3em;margin-top:1px}.search-and-views[_ngcontent-%COMP%]{padding-top:1.125rem;display:flex;justify-content:space-between;border-top:1px solid #e9ecef}.search[_ngcontent-%COMP%]{flex:auto;max-width:300px;margin-right:1.5rem}.views[_ngcontent-%COMP%]{display:flex}.view[_ngcontent-%COMP%]{padding:.25rem;color:#6c757d}.view.active[_ngcontent-%COMP%]{color:#33333d}@media (max-width:380px){[_nghost-%COMP%]{padding-left:.75rem;padding-right:.75rem}#search-addon[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}}@media (max-width:365px){.lesson-time[_ngcontent-%COMP%]{line-height:1}.lesson-time-to[_ngcontent-%COMP%]{display:block}.dropdown-caret[_ngcontent-%COMP%]{padding-left:0}}']}),e})();var ve=t("jtHE"),Ce=t("PT0D");const we=function(e){return["/presence-control/student",e]};function Me(e,n){if(1&e&&(E.Lb(0,"erz-avatar",7),E.ec(1,"async")),2&e){const e=E.dc();E.jc("studentId",E.fc(1,3,e.studentId$))("link",E.nc(5,we,e.entry.lessonPresence.StudentRef.Id))("linkParams",e.profileReturnParams)}}function _e(e,n){if(1&e&&(E.Pb(0,"span"),E.Ec(1),E.Ob()),2&e){const e=E.dc(2);E.xb(1),E.Fc(null==e.entry.presenceType?null:e.entry.presenceType.Designation)}}function xe(e,n){if(1&e){const e=E.Qb();E.Pb(0,"button",8),E.bc("click",(function(){E.uc(e);const n=E.dc();return n.updatePresenceType(n.entry)})),E.Cc(1,_e,2,1,"span",9),E.Ob()}if(2&e){const e=E.dc();E.xb(1),E.jc("ngIf",!(null!=e.entry.presenceType&&e.entry.presenceType.IsIncident))}}function je(e,n){if(1&e){const e=E.Qb();E.Pb(0,"a",10),E.bc("click",(function(){E.uc(e);const n=E.dc();return n.updateIncident(n.entry)})),E.Pb(1,"i",3),E.Ec(2,"edit"),E.Ob(),E.Pb(3,"span"),E.Ec(4),E.ec(5,"translate"),E.Ob(),E.Ob()}if(2&e){const e=E.dc();E.xb(4),E.Fc(E.fc(5,1,(null==e.entry.presenceType?null:e.entry.presenceType.IsIncident)&&(null==e.entry.presenceType?null:e.entry.presenceType.Designation)||"presence-control.entry.incident"))}}let Ie=(()=>{class e{constructor(e,n){this.toastr=e,this.translate=n,this.hasUnconfirmedAbsences=!1,this.togglePresenceType=new E.n,this.changeIncident=new E.n,this.studentId$=new ve.a(1)}get classNames(){return[this.entry.presenceCategory,this.viewMode].join(" ")}ngOnInit(){}ngOnChanges(e){e.entry&&this.studentId$.next(e.entry.currentValue.lessonPresence.StudentRef.Id)}get isListViewMode(){return this.viewMode===D.List}updatePresenceType(e){e.canChangePresenceType?this.togglePresenceType.emit(e):this.toastr.warning(this.translate.instant("presence-control.entry.update-warning"))}updateIncident(e){e.canChangeIncident&&this.changeIncident.emit(e)}}return e.\u0275fac=function(n){return new(n||e)(E.Kb(W.b),E.Kb(J.d))},e.\u0275cmp=E.Eb({type:e,selectors:[["erz-presence-control-entry"]],hostVars:2,hostBindings:function(e,n){2&e&&E.zb(n.classNames)},inputs:{entry:"entry",hasUnconfirmedAbsences:"hasUnconfirmedAbsences",viewMode:"viewMode",profileReturnParams:"profileReturnParams"},outputs:{togglePresenceType:"togglePresenceType",changeIncident:"changeIncident"},features:[E.vb],decls:11,vars:12,consts:[["class","avatar large",3,"studentId","link","linkParams",4,"ngIf"],["type","button","class","presence-category designation btn btn-link",3,"click",4,"ngIf"],["type","button",1,"presence-category","status","btn","btn-link",3,"click"],[1,"material-icons"],[1,"student-name",3,"routerLink","queryParams"],[1,"unconfirmed-absences"],["class","incident btn btn-link",3,"click",4,"ngIf"],[1,"avatar","large",3,"studentId","link","linkParams"],["type","button",1,"presence-category","designation","btn","btn-link",3,"click"],[4,"ngIf"],[1,"incident","btn","btn-link",3,"click"]],template:function(e,n){1&e&&(E.Cc(0,Me,2,7,"erz-avatar",0),E.Cc(1,xe,2,1,"button",1),E.Pb(2,"button",2),E.bc("click",(function(){return n.updatePresenceType(n.entry)})),E.Pb(3,"i",3),E.Ec(4),E.Ob(),E.Ob(),E.Pb(5,"a",4),E.Ec(6),E.Pb(7,"span",5),E.Ec(8),E.ec(9,"translate"),E.Ob(),E.Ob(),E.Cc(10,je,6,3,"a",6)),2&e&&(E.jc("ngIf",!n.isListViewMode),E.xb(1),E.jc("ngIf",n.entry.showDesignation),E.xb(3),E.Fc(n.entry.presenceCategoryIcon),E.xb(1),E.jc("routerLink",E.nc(10,we,n.entry.lessonPresence.StudentRef.Id))("queryParams",n.profileReturnParams),E.xb(1),E.Gc(" ",n.entry.lessonPresence.StudentFullName," "),E.xb(2),E.Gc(" ",n.hasUnconfirmedAbsences?E.fc(9,8,"presence-control.entry.unconfirmed-absences"):""," "),E.xb(2),E.jc("ngIf",n.entry.canChangeIncident))},directives:[S.m,c.g,Ce.a],pipes:[J.c,S.b],styles:['[_nghost-%COMP%]{padding:3rem 1.5rem;background-color:#fff;display:-ms-grid;display:grid;grid-template-areas:"avatar status designation" "avatar student-name student-name" "avatar incident incident";-ms-grid-columns:-webkit-min-content -webkit-min-content 1fr;-ms-grid-columns:min-content min-content 1fr;grid-template-columns:-webkit-min-content -webkit-min-content 1fr;grid-template-columns:min-content min-content 1fr}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{-ms-grid-row-align:center;align-self:center}.presence-category[_ngcontent-%COMP%]{text-decoration:none}.presence-category[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:relative;top:.1875rem}.absent[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#dc3545}.present[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#28a745}.unapproved[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#ffa814}.designation[_ngcontent-%COMP%], .incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .student-name[_ngcontent-%COMP%], a.incident[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.avatar[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-row-span:3;-ms-grid-column:1;grid-area:avatar;margin-right:2.25rem}.status[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2;grid-area:status}.list[_nghost-%COMP%] > .status[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:3}.status[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2.75rem}.designation[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:3;grid-area:designation;text-align:left;line-height:3.125rem}.student-name[_ngcontent-%COMP%]{-ms-grid-row:2;-ms-grid-column:2;-ms-grid-column-span:2;color:#33333d;grid-area:student-name;display:flex;flex-direction:column}.list[_nghost-%COMP%] > .student-name[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:1;-ms-grid-column-span:1}.unconfirmed-absences[_ngcontent-%COMP%]{color:#dc3545;font-size:1.1rem;line-height:1}.incident[_ngcontent-%COMP%]{-ms-grid-row:3;-ms-grid-column:2;-ms-grid-column-span:2;color:rgba(51,51,61,.5);padding-right:.75rem;grid-area:incident;display:flex}.incident[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}.grid[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .grid[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{-ms-grid-row-align:start;align-self:start;margin-left:-.75rem;margin-top:-.375rem}.grid[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{-ms-grid-row-align:end;align-self:end;margin-left:-.75rem;margin-bottom:-.375rem}.grid[_nghost-%COMP%]   .unconfirmed-absences[_ngcontent-%COMP%]{height:1.1rem}.list[_nghost-%COMP%]{grid-template-areas:"student-name incidentordesignation status";-ms-grid-columns:1fr 2fr -webkit-min-content;-ms-grid-columns:1fr 2fr min-content;grid-template-columns:1fr 2fr -webkit-min-content;grid-template-columns:1fr 2fr min-content;padding:.5rem .5rem .5rem 1rem}.list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2;grid-area:incidentordesignation}.list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%]{text-align:right}.list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{margin-left:-.75rem}@media (max-width:750px){.list[_nghost-%COMP%]{grid-template-areas:"student-name status" "incidentordesignation incidentordesignation";-ms-grid-columns:1fr -webkit-min-content;-ms-grid-columns:1fr min-content;grid-template-columns:1fr -webkit-min-content;grid-template-columns:1fr min-content}.list[_nghost-%COMP%] > .status[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2}.list[_nghost-%COMP%] > .student-name[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:1;-ms-grid-column-span:1}.list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{-ms-grid-row:2;-ms-grid-column:1;-ms-grid-column-span:2}}']}),e})();var $e=t("4Kj8");const Le=function(e){return{returnparams:e}};function ke(e,n){if(1&e){const e=E.Qb();E.Pb(0,"erz-presence-control-entry",10),E.bc("togglePresenceType",(function(n){return E.uc(e),E.dc(6).togglePresenceType(n)}))("changeIncident",(function(n){return E.uc(e),E.dc(6).changeIncident(n)})),E.ec(1,"async"),E.ec(2,"async"),E.ec(3,"async"),E.Ob()}if(2&e){const e=n.$implicit,t=E.dc(6);E.jc("entry",e)("hasUnconfirmedAbsences",E.fc(1,4,t.state.hasUnconfirmedAbsences(e)))("viewMode",E.fc(2,6,t.state.viewMode$))("profileReturnParams",E.nc(10,Le,E.fc(3,8,t.state.queryParamsString$)))}}function Te(e,n){if(1&e&&(E.Pb(0,"div",8),E.Pb(1,"label",9),E.Ec(2),E.ec(3,"translate"),E.Ob(),E.Pb(4,"div"),E.ec(5,"async"),E.Cc(6,ke,4,12,"erz-presence-control-entry",7),E.Ob(),E.Ob()),2&e){const e=E.dc(4).erzLet,n=E.dc();E.xb(2),E.Gc(" ",E.fc(3,5,"presence-control.previously-absent")," "),E.xb(2),E.Ab("entries view-mode-",E.fc(5,7,n.state.viewMode$),""),E.xb(2),E.jc("ngForOf",e.previouslyAbsentEntries)}}function Ee(e,n){if(1&e){const e=E.Qb();E.Pb(0,"erz-presence-control-entry",10),E.bc("togglePresenceType",(function(n){return E.uc(e),E.dc(5).togglePresenceType(n)}))("changeIncident",(function(n){return E.uc(e),E.dc(5).changeIncident(n)})),E.ec(1,"async"),E.ec(2,"async"),E.ec(3,"async"),E.Ob()}if(2&e){const e=n.$implicit,t=E.dc(5);E.jc("entry",e)("hasUnconfirmedAbsences",E.fc(1,4,t.state.hasUnconfirmedAbsences(e)))("viewMode",E.fc(2,6,t.state.viewMode$))("profileReturnParams",E.nc(10,Le,E.fc(3,8,t.state.queryParamsString$)))}}function Se(e,n){if(1&e&&(E.Nb(0),E.Cc(1,Te,7,9,"div",6),E.Pb(2,"div"),E.ec(3,"async"),E.Cc(4,Ee,4,12,"erz-presence-control-entry",7),E.Ob(),E.Mb()),2&e){const e=E.dc(3).erzLet,n=E.dc();E.xb(1),E.jc("ngIf",e.previouslyAbsentEntries.length>0),E.xb(1),E.Ab("default-entries entries view-mode-",E.fc(3,5,n.state.viewMode$),""),E.xb(2),E.jc("ngForOf",e.previouslyPresentEntries)}}function De(e,n){1&e&&(E.Pb(0,"p",11),E.Ec(1),E.ec(2,"translate"),E.Ob()),2&e&&(E.xb(1),E.Gc(" ",E.fc(2,1,"presence-control.no-lesson-presences")," "))}function Ue(e,n){if(1&e&&(E.Nb(0),E.Cc(1,Se,5,7,"ng-container",1),E.Cc(2,De,3,3,"ng-template",null,5,E.Dc),E.Mb()),2&e){const e=E.tc(3),n=E.dc(2).erzLet;E.xb(1),E.jc("ngIf",n.entries.length>0)("ngIfElse",e)}}function Re(e,n){1&e&&(E.Pb(0,"p",12),E.Ec(1),E.ec(2,"translate"),E.Ob()),2&e&&(E.xb(1),E.Fc(E.fc(2,1,"presence-control.no-lessons")))}function Ae(e,n){if(1&e){const e=E.Qb();E.Nb(0),E.Pb(1,"erz-presence-control-header",3),E.bc("searchChange",(function(n){return E.uc(e),E.dc(2).search$.next(n)}))("viewModeChange",(function(n){return E.uc(e),E.dc(2).state.setViewMode(n)}))("selectDateChange",(function(n){return E.uc(e),E.dc(2).state.setDate(n)}))("selectLessonChange",(function(n){return E.uc(e),E.dc(2).state.setLesson(n)})),E.ec(2,"async"),E.ec(3,"async"),E.ec(4,"async"),E.ec(5,"async"),E.ec(6,"async"),E.ec(7,"async"),E.Ob(),E.Cc(8,Ue,4,2,"ng-container",1),E.Cc(9,Re,3,3,"ng-template",null,4,E.Dc),E.Mb()}if(2&e){const e=E.tc(10),n=E.dc().erzLet,t=E.dc();E.xb(1),E.jc("selectedLesson",n.lesson)("lessons",n.lessons)("presentCount",E.fc(2,10,t.state.presentCount$))("absentCount",E.fc(3,12,t.state.absentCount$))("unapprovedCount",E.fc(4,14,t.state.unapprovedCount$))("viewMode",E.fc(5,16,t.state.viewMode$))("selectDate",E.fc(6,18,t.state.selectedDate$))("search",E.fc(7,20,t.search$)),E.xb(7),E.jc("ngIf",n.lesson)("ngIfElse",e)}}function Fe(e,n){1&e&&E.Lb(0,"erz-spinner")}function ze(e,n){if(1&e&&(E.Nb(0),E.Cc(1,Ae,11,22,"ng-container",1),E.ec(2,"async"),E.Cc(3,Fe,1,0,"ng-template",null,2,E.Dc),E.Mb()),2&e){const e=E.tc(4),n=E.dc();E.xb(1),E.jc("ngIf",!E.fc(2,2,n.state.loading$))("ngIfElse",e)}}const Ge=function(e,n,t,s,c){return{lesson:e,lessons:n,entries:t,previouslyPresentEntries:s,previouslyAbsentEntries:c}};let He=(()=>{class e{constructor(e,n,t,s,c,r){this.state=e,this.lessonPresencesUpdateService=n,this.presenceTypesService=t,this.modalService=s,this.scrollPosition=c,this.route=r,this.search$=new o.a(""),this.entries$=Object(d.a)([this.state.selectedPresenceControlEntries$,this.search$]).pipe(Object(u.a)(Object(C.a)(se.a)),Object(g.a)(1)),this.previouslyPresentEntries$=this.entries$.pipe(Object(u.a)(_)),this.previouslyAbsentEntries$=this.entries$.pipe(Object(u.a)(x)),this.destroy$=new i.a}ngOnInit(){this.route.queryParams.pipe(Object(r.a)(this.destroy$)).subscribe(this.restoreStateFromParams.bind(this))}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}doTogglePresenceType(e,n){this.state.getNextPresenceType(e).subscribe(t=>this.lessonPresencesUpdateService.updatePresenceTypes(n||[e.lessonPresence],t?t.Id:null))}togglePresenceType(e){this.state.getBlockLessonPresences(e).pipe(Object(h.a)(1)).subscribe(n=>{if(1===n.length)this.doTogglePresenceType(e);else{const t=this.modalService.open(oe);t.componentInstance.entry=e,t.componentInstance.blockLessonPresences=n,t.result.then(n=>{n&&this.doTogglePresenceType(e,n)},()=>{})}})}updateIncident(e,n){this.lessonPresencesUpdateService.updatePresenceTypes([e.lessonPresence],n)}changeIncident(e){this.presenceTypesService.incidentTypes$.subscribe(n=>{const t=this.modalService.open(pe);t.componentInstance.incident=n.find(n=>{var t;return n.Id===(null===(t=e.presenceType)||void 0===t?void 0:t.Id)})||null,t.componentInstance.incidentTypes=n,t.result.then(n=>{this.updateIncident(e,(null==n?void 0:n.Id)||null)},()=>{})})}restoreStateFromParams(e){e.date&&this.state.setDate(Object(de.c)(e.date));const n=Number(e.lesson);n&&this.state.lessons$.pipe(Object(h.a)(1)).subscribe(e=>{const t=e.find(e=>e.LessonRef.Id===n);t&&this.state.setLesson(t)}),e.viewMode&&U.includes(e.viewMode)&&this.state.setViewMode(e.viewMode)}}return e.\u0275fac=function(n){return new(n||e)(E.Kb(R),E.Kb(Z),E.Kb(v.a),E.Kb(ce.k),E.Kb(ae.a),E.Kb(c.a))},e.\u0275cmp=E.Eb({type:e,selectors:[["erz-presence-control-list"]],decls:6,vars:17,consts:[[4,"erzLet"],[4,"ngIf","ngIfElse"],["loading",""],[3,"selectedLesson","lessons","presentCount","absentCount","unapprovedCount","viewMode","selectDate","search","searchChange","viewModeChange","selectDateChange","selectLessonChange"],["noLessons",""],["noLessonPresences",""],["class","previously-absent-entries pt-1 px-2 pb-3",4,"ngIf"],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident",4,"ngFor","ngForOf"],[1,"previously-absent-entries","pt-1","px-2","pb-3"],[1,"mb-1"],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident"],[1,"mt-3","pl-3"],[1,"mt-3","px-3"]],template:function(e,n){1&e&&(E.Cc(0,ze,5,4,"ng-container",0),E.ec(1,"async"),E.ec(2,"async"),E.ec(3,"async"),E.ec(4,"async"),E.ec(5,"async")),2&e&&E.jc("erzLet",E.rc(11,Ge,E.fc(1,1,n.state.selectedLesson$),E.fc(2,3,n.state.lessons$),E.fc(3,5,n.entries$),E.fc(4,7,n.previouslyPresentEntries$),E.fc(5,9,n.previouslyAbsentEntries$)))},directives:[be.a,S.m,ye,S.l,Ie,$e.a],pipes:[S.b,J.c],styles:["erz-presence-control-entry[_ngcontent-%COMP%]{border-bottom:1px solid #e9ecef}.previously-absent-entries[_ngcontent-%COMP%]{background-color:#fae3e5}.previously-absent-entries[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{color:#dc3545;padding-left:.5rem}.previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%]{background-color:#fff}.previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%] > .absent.list[_ngcontent-%COMP%], .previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%] > .present.list[_ngcontent-%COMP%]{padding:0 0 0 .5rem}@media only screen and (max-device-width:800px),only screen and (max-width:800px){.previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%] > .absent.grid[_ngcontent-%COMP%], .previously-absent-entries[_ngcontent-%COMP%] > .entries[_ngcontent-%COMP%] > .present.grid[_ngcontent-%COMP%]{padding-right:.5rem;padding-left:.5rem}}.entries.view-mode-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}@media (min-width:400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;border-right:1px solid #e9ecef}}@media (min-width:800px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:50%;border-right:1px solid #e9ecef}}@media (min-width:1200px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:33.33333333%;border-right:1px solid #e9ecef}}@media (min-width:1600px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:25%;border-right:1px solid #e9ecef}}@media (min-width:2000px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:20%;border-right:1px solid #e9ecef}}@media (min-width:2400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:16.66666667%;border-right:1px solid #e9ecef}}"],changeDetection:0}),e})();var Ke=t("hH5/");const Xe=[{path:"",component:te,children:[{path:"",component:He,data:{restoreScrollPositionFrom:["/presence-control/student/:id"]}},{path:"student/:id",children:[{path:"",component:t("ccj6").a},{path:"confirm",component:Ke.a}]}]}];let Ne=(()=>{class e{}return e.\u0275mod=E.Ib({type:e}),e.\u0275inj=E.Hb({factory:function(n){return new(n||e)},imports:[[c.h.forChild(Xe)],c.h]}),e})();var Qe=t("0HM3");let qe=(()=>{class e{}return e.\u0275mod=E.Ib({type:e}),e.\u0275inj=E.Hb({factory:function(n){return new(n||e)},providers:[{provide:Qe.a,useValue:"/presence-control"}],imports:[[s.a,Ne]]}),e})()}}]);