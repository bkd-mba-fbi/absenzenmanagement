!function(){function e(n,t,c){return(e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){var c=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=i(e)););return e}(e,n);if(c){var r=Object.getOwnPropertyDescriptor(c,n);return r.get?r.get.call(t):r.value}})(n,t,c||n)}function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t(e,n)}function t(e,n){return(t=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function c(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,c=i(e);if(n){var s=i(this).constructor;t=Reflect.construct(c,arguments,s)}else t=c.apply(this,arguments);return r(this,t)}}function r(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],c=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(c=(s=o.next()).done)&&(t.push(s.value),!n||t.length!==n);c=!0);}catch(a){r=!0,i=a}finally{try{c||null==o.return||o.return()}finally{if(r)throw i}}return t}(e,n)||a(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,n){if(e){if("string"==typeof e)return l(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,n):void 0}}function l(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,c=new Array(n);t<n;t++)c[t]=e[t];return c}function u(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function b(e,n){for(var t=0;t<n.length;t++){var c=n[t];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function d(e,n,t){return n&&b(e.prototype,n),t&&b(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{CZtb:function(t,r,a){"use strict";a.r(r),a.d(r,"MyAbsencesModule",(function(){return Un}));var l,b,f,p=a("PCNd"),m=a("tyNb"),g=a("jtHE"),y=a("itXk"),v=a("eIep"),h=a("UXun"),O=a("pLZG"),P=a("lJxs"),C=a("IzEk"),k=a("JX91"),j=a("oB13"),I=a("x+ZX"),x=a("Xr/R"),S=a("fbMX"),$=a("mmcK"),L=a("IClS"),w=a("K+0v"),T=a("eB9A"),E=a("fXoL"),M=((b=function(){function e(n,t,c){var r;u(this,e),this.settings=n,this.storageService=t,this.studentsService=c,this.studentId$=new g.a(1),this.lessonAbsences$=this.studentId$.pipe(Object(v.a)(this.loadLessonAbsences.bind(this)),Object(h.a)(1)),this.lessonIncidents$=this.studentId$.pipe(Object(v.a)(this.loadLessonIncidents.bind(this)),Object(h.a)(1)),this.lessonPresences$=this.getLessonPresences(),this.openAbsences$=this.getAbsences(this.settings.unconfirmedAbsenceStateId),this.excusedAbsences$=this.getAbsences(this.settings.excusedAbsenceStateId),this.unexcusedAbsences$=this.getAbsences(this.settings.unexcusedAbsenceStateId),this.incidents$=this.getAbsences(null),this.openLessonAbsences$=Object(y.a)([this.openAbsences$.pipe(Object(O.a)(w.e)),this.lessonAbsences$]).pipe(Object(P.a)(Object(T.a)(this.getOpenLessonAbsences.bind(this))),Object(h.a)(1)),this.counts$=this.getCounts();var i=(null===(r=this.storageService.getPayload())||void 0===r?void 0:r.id_person)||null;i&&this.studentId$.next(i)}return d(e,[{key:"reset",value:function(){var e=this;this.studentId$.pipe(Object(C.a)(1)).subscribe((function(n){return e.studentId$.next(n)}))}},{key:"getLessonPresences",value:function(){var e=this;return this.getCached(Object(y.a)([this.studentId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(Object(v.a)((function(n){var t=o(n,3),c=t[0],r=t[1],i=t[2];return e.loadTimetableEntries(c,r,i).pipe(Object(P.a)((function(n){return e.buildLessonPresences(r,i,n)})))})),Object(P.a)(L.c)))}},{key:"getAbsences",value:function(e){return this.getCached(this.lessonPresences$.pipe(Object(P.a)((function(n){return(null==n?void 0:n.filter((function(n){return n.ConfirmationStateId===e})))||null}))))}},{key:"getOpenLessonAbsences",value:function(e,n){var t=e.map((function(e){return e.LessonRef.Id}));return n.filter((function(e){return t.includes(e.LessonRef.Id)}))}},{key:"getCounts",value:function(){return Object(y.a)([this.getCount(this.openAbsences$),this.getCount(this.excusedAbsences$),this.getCount(this.unexcusedAbsences$),this.getCount(this.incidents$)]).pipe(Object(P.a)((function(e){var n=o(e,4);return{openAbsences:n[0],excusedAbsences:n[1],unexcusedAbsences:n[2],incidents:n[3],halfDays:null}})))}},{key:"getCached",value:function(e){return e.pipe(Object(k.a)(null),Object(j.a)((function(){return new g.a(1)})),Object(I.a)())}},{key:"getCount",value:function(e){return e.pipe(Object(P.a)((function(e){var n;return null!==(n=null==e?void 0:e.length)&&void 0!==n?n:null})))}},{key:"loadLessonAbsences",value:function(e){return this.studentsService.getLessonAbsences(e)}},{key:"loadLessonIncidents",value:function(e){return this.studentsService.getLessonIncidents(e)}},{key:"loadTimetableEntries",value:function(e,n,t){return this.studentsService.getTimetableEntries(e,{"filter.Id":";"+[].concat(s(n),s(t)).map((function(e){return e.LessonRef.Id})).join(";"),fields:"Id,From,To,EventNumber,EventDesignation,EventManagerInformation"})}},{key:"buildLessonPresences",value:function(e,n,t){var c=this;return[].concat(s(e),s(n)).map((function(e){return c.buildLessonPresence(e,t)})).filter(w.e)}},{key:"buildLessonPresence",value:function(e,n){var t=n.find((function(n){return n.Id===e.LessonRef.Id}));return t?{Id:"",LessonRef:e.LessonRef,StudentRef:e.StudentRef,EventRef:{Id:0,HRef:null},TypeRef:e.TypeRef,ConfirmationStateId:"ConfirmationStateId"in e?e.ConfirmationStateId:null,EventDesignation:t.EventDesignation,HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:t.From,LessonDateTimeTo:t.To,Comment:null,Date:t.From,Type:e.Type,StudentFullName:e.StudentFullName,StudyClassNumber:"",TeacherInformation:t.EventManagerInformation,WasAbsentInPrecedingLesson:!1}:null}}]),e}()).\u0275fac=function(e){return new(e||b)(E.Xb(x.a),E.Xb(S.a),E.Xb($.a))},b.\u0275prov=E.Gb({token:b,factory:b.\u0275fac}),b),A=((l=function(){function e(){u(this,e)}return d(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||l)},l.\u0275cmp=E.Eb({type:l,selectors:[["erz-my-absences"]],features:[E.wb([M])],decls:1,vars:0,template:function(e,n){1&e&&E.Lb(0,"router-outlet")},directives:[m.i],styles:[""],changeDetection:0}),l),F=a("XNiG"),D=a("LRne"),_=a("5QKP"),z=a("Ug8t"),R=a("8teX"),G=a("BeL+"),K=a("tPH9"),N=a("ylTp"),H=a("9f76"),X=a("/1FC"),B=N.a?N.a.isConcatSpreadable:void 0,U=function(e){return Object(X.a)(e)||Object(H.a)(e)||!!(B&&e&&e[B])},Q=function(e){return null!=e&&e.length?function e(n,t,c,r,i){var s=-1,o=n.length;for(c||(c=U),i||(i=[]);++s<o;){var a=n[s];t>0&&c(a)?t>1?e(a,t-1,c,r,i):Object(K.a)(i,a):r||(i[i.length]=a)}return i}(e,1):[]},q=a("EOpz"),Y=a("1kSV"),J=a("sYmb"),V=["link"],W=function(){return["/my-absences/report"]},Z=((f=function(){function e(){u(this,e)}return d(e,[{key:"onClick",value:function(){this.link.nativeElement.click()}},{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||f)},f.\u0275cmp=E.Eb({type:f,selectors:[["erz-my-absences-report-link"]],viewQuery:function(e,n){var t;1&e&&E.Jc(V,!0),2&e&&E.sc(t=E.cc())&&(n.link=t.first)},hostBindings:function(e,n){1&e&&E.bc("click",(function(e){return n.onClick(e)}))},decls:8,vars:5,consts:[[1,"m-0"],[1,"btn","btn-link","p-0",3,"routerLink"],["link",""],[1,"d-flex","align-items-center"],[1,"material-icons"]],template:function(e,n){1&e&&(E.Pb(0,"h5",0),E.Ec(1),E.ec(2,"translate"),E.Ob(),E.Pb(3,"a",1,2),E.Pb(5,"div",3),E.Pb(6,"i",4),E.Ec(7,"keyboard_arrow_right"),E.Ob(),E.Ob(),E.Ob()),2&e&&(E.xb(1),E.Gc(" ",E.fc(2,2,"my-absences.report.title"),"\n"),E.xb(2),E.jc("routerLink",E.mc(4,W)))},directives:[m.g],pipes:[J.c],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;cursor:pointer}.btn[_ngcontent-%COMP%]{color:#33333d;text-decoration:none}"],changeDetection:0}),f),ee=a("4vw6"),ne=a("ofXK"),te=a("ZLMY");function ce(e,n){1&e&&E.Lb(0,"erz-my-absences-report-link")}function re(e,n){}function ie(e,n){if(1&e&&(E.Nb(0),E.Ec(1),E.Mb()),2&e){var t=E.dc(2).erzLet;E.xb(1),E.Gc("(",t.absenceCounts.openAbsences,")")}}function se(e,n){if(1&e){var t=E.Qb();E.Pb(0,"erz-student-profile-entry-header",11),E.bc("click",(function(){return E.uc(t),E.dc(),E.tc(2).toggle("open-absences")})),E.Ec(1),E.ec(2,"translate"),E.Cc(3,ie,2,1,"ng-container",12),E.Ob()}if(2&e){var c=n.opened,r=E.dc().erzLet;E.jc("opened",c),E.xb(1),E.Gc(" ",E.fc(2,3,"shared.profile.open-absences")," "),E.xb(2),E.jc("ngIf",null!=r.absenceCounts.openAbsences)}}function oe(e,n){if(1&e&&(E.Lb(0,"erz-student-profile-absences",13),E.ec(1,"translate"),E.ec(2,"async"),E.ec(3,"async")),2&e){var t=E.dc(2);E.jc("absences$",t.myAbsencesService.openAbsences$)("selectionService",t.absencesSelectionService)("defaultAbsenceSelectionMessage",E.fc(1,5,"my-absences.show.default-absence-selection-message"))("reportUrl",E.fc(2,7,t.reportUrl$))("reportAvailable",E.fc(3,9,t.reportAvailable$))}}function ae(e,n){if(1&e&&(E.Nb(0),E.Ec(1),E.Mb()),2&e){var t=E.dc(2).erzLet;E.xb(1),E.Gc("(",t.absenceCounts.excusedAbsences,")")}}function le(e,n){if(1&e){var t=E.Qb();E.Pb(0,"erz-student-profile-entry-header",11),E.bc("click",(function(){return E.uc(t),E.dc(),E.tc(2).toggle("excused-absences")})),E.Ec(1),E.ec(2,"translate"),E.Cc(3,ae,2,1,"ng-container",12),E.Ob()}if(2&e){var c=n.opened,r=E.dc().erzLet;E.jc("opened",c),E.xb(1),E.Gc(" ",E.fc(2,3,"shared.profile.excused-absences")," "),E.xb(2),E.jc("ngIf",null!=r.absenceCounts.excusedAbsences)}}function ue(e,n){if(1&e&&E.Lb(0,"erz-student-profile-absences",14),2&e){var t=E.dc(2);E.jc("absences$",t.myAbsencesService.excusedAbsences$)}}function be(e,n){if(1&e&&(E.Nb(0),E.Ec(1),E.Mb()),2&e){var t=E.dc(2).erzLet;E.xb(1),E.Gc("(",t.absenceCounts.unexcusedAbsences,")")}}function de(e,n){if(1&e){var t=E.Qb();E.Pb(0,"erz-student-profile-entry-header",11),E.bc("click",(function(){return E.uc(t),E.dc(),E.tc(2).toggle("unexcused-absences")})),E.Ec(1),E.ec(2,"translate"),E.Cc(3,be,2,1,"ng-container",12),E.Ob()}if(2&e){var c=n.opened,r=E.dc().erzLet;E.jc("opened",c),E.xb(1),E.Gc(" ",E.fc(2,3,"shared.profile.unexcused-absences")," "),E.xb(2),E.jc("ngIf",null!=r.absenceCounts.unexcusedAbsences)}}function fe(e,n){if(1&e&&E.Lb(0,"erz-student-profile-absences",15),2&e){var t=E.dc(2);E.jc("absences$",t.myAbsencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function pe(e,n){if(1&e&&(E.Nb(0),E.Ec(1),E.Mb()),2&e){var t=E.dc(2).erzLet;E.xb(1),E.Gc("(",t.absenceCounts.incidents,")")}}function me(e,n){if(1&e){var t=E.Qb();E.Pb(0,"erz-student-profile-entry-header",11),E.bc("click",(function(){return E.uc(t),E.dc(),E.tc(2).toggle("incidents")})),E.Ec(1),E.ec(2,"translate"),E.Cc(3,pe,2,1,"ng-container",12),E.Ob()}if(2&e){var c=n.opened,r=E.dc().erzLet;E.jc("opened",c),E.xb(1),E.Gc(" ",E.fc(2,3,"shared.profile.incidents")," "),E.xb(2),E.jc("ngIf",null!=r.absenceCounts.incidents)}}function ge(e,n){if(1&e&&E.Lb(0,"erz-student-profile-absences",14),2&e){var t=E.dc(2);E.jc("absences$",t.myAbsencesService.incidents$)}}function ye(e,n){1&e&&(E.Pb(0,"div",1),E.Pb(1,"ngb-accordion",2,3),E.Pb(3,"ngb-panel",4),E.Cc(4,ce,1,0,"ng-template",5),E.Cc(5,re,0,0,"ng-template",6),E.Ob(),E.Pb(6,"ngb-panel",7),E.Cc(7,se,4,5,"ng-template",5),E.Cc(8,oe,4,11,"ng-template",6),E.Ob(),E.Pb(9,"ngb-panel",8),E.Cc(10,le,4,5,"ng-template",5),E.Cc(11,ue,1,1,"ng-template",6),E.Ob(),E.Pb(12,"ngb-panel",9),E.Cc(13,de,4,5,"ng-template",5),E.Cc(14,fe,1,2,"ng-template",6),E.Ob(),E.Pb(15,"ngb-panel",10),E.Cc(16,me,4,5,"ng-template",5),E.Cc(17,ge,1,1,"ng-template",6),E.Ob(),E.Ob(),E.Ob())}var ve,he,Oe=function(e){return{absenceCounts:e}},Pe=((ve=function(){function e(n,t,c){u(this,e),this.reportsService=n,this.myAbsencesService=t,this.absencesSelectionService=c,this.reportUrl$=this.loadReportUrl(),this.reportAvailable$=this.reportsService.studentConfirmationAvailability$,this.destroy$=new F.a}return d(e,[{key:"ngOnInit",value:function(){var e=this;this.myAbsencesService.openLessonAbsences$.pipe(Object(C.a)(1),Object(O.a)(Object(w.d)(R.b))).subscribe((function(n){return e.reportsService.setStudentConfirmationAvailabilityRecordId("".concat(n[0].LessonRef.Id,"_").concat(n[0].RegistrationId))}))}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"loadReportUrl",value:function(){var e=this;return Object(y.a)([this.absencesSelectionService.selectedWithoutPresenceType$,this.absencesSelectionService.selectedIds$]).pipe(Object(v.a)((function(n){var t=o(n,2),c=t[0],r=t[1];return 0===c.length&&r.length>0?e.getReportRecordIds(Object(G.a)(Q(r.map((function(e){return e.lessonIds}))))):Object(D.a)(null)})),Object(P.a)((function(n){return n?e.reportsService.getStudentConfirmationUrl(n):null})))}},{key:"getReportRecordIds",value:function(e){return this.myAbsencesService.openLessonAbsences$.pipe(Object(P.a)((function(n){return n.filter((function(n){return e.includes(n.LessonRef.Id)})).map((function(e){return"".concat(e.LessonRef.Id,"_").concat(e.RegistrationId)}))})))}}]),e}()).\u0275fac=function(e){return new(e||ve)(E.Kb(z.a),E.Kb(M),E.Kb(_.a))},ve.\u0275cmp=E.Eb({type:ve,selectors:[["erz-my-absences-show"]],decls:2,vars:5,consts:[["class","erz-container erz-container-padding-y erz-container-padding-x-responsive",4,"erzLet"],[1,"erz-container","erz-container-padding-y","erz-container-padding-x-responsive"],["ngb-accordion",""],["acc","ngbAccordion"],["id","report-absence"],["ngbPanelHeader",""],["ngbPanelContent",""],["id","open-absences"],["id","excused-absences"],["id","unexcused-absences"],["id","incidents"],[3,"opened","click"],[4,"ngIf"],[3,"absences$","selectionService","defaultAbsenceSelectionMessage","reportUrl","reportAvailable"],[3,"absences$"],[3,"absences$","displayPresenceType"]],template:function(e,n){1&e&&(E.Cc(0,ye,18,0,"div",0),E.ec(1,"async")),2&e&&E.jc("erzLet",E.nc(3,Oe,E.fc(1,1,n.myAbsencesService.counts$)))},directives:[q.a,Y.a,Y.m,Y.o,Y.n,Z,ee.a,ne.m,te.a],pipes:[ne.b,J.c],styles:[""],changeDetection:0}),ve),Ce=a("3Pt+"),ke=a("2Vo4"),je=a("wO+i"),Ie=a("nYR2"),xe=a("LpL1"),Se=a("KJh6"),$e=a("A6ef"),Le=a("5eHb"),we=((he=function(){function e(n,t,c,r,i,a,l,b){u(this,e),this.fb=n,this.router=t,this.toastr=c,this.translate=r,this.presenceTypesService=i,this.updateService=a,this.storageService=l,this.settings=b,this.formGroup=this.createFormGroup(),this.saving$=new ke.a(!1),this.submitted$=new ke.a(!1),this.absenceTypes$=Object(y.a)([this.getConfirmationTypes(),this.getHalfDayType()]).pipe(Object(P.a)((function(e){var n=o(e,2),t=n[0],c=n[1];return c?[].concat(s(t),[c]):t}))),this.absenceTypeIdErrors$=Object($e.c)(Object(D.a)(this.formGroup),this.submitted$,"absenceTypeId"),this.confirmationStateId=null,this.destroy$=new F.a}return d(e,[{key:"ngOnInit",value:function(){var e=this;this.selectedLessonIds$.pipe(Object(C.a)(1),Object(O.a)(R.b)).subscribe((function(){return e.navigateBack()}))}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"onSubmit",value:function(){if(this.submitted$.next(!0),this.formGroup.valid){var e=this.formGroup.value.absenceTypeId;this.save(e)}}},{key:"cancel",value:function(){this.navigateBack()}},{key:"getSelectedCount",value:function(){return this.selectedLessonIds$.pipe(Object(je.a)("length"))}},{key:"getConfirmationTypes",value:function(){var e=this;return this.presenceTypesService.confirmationTypes$.pipe(Object(P.a)((function(n){return n.filter((function(n){return n.IsAbsence&&n.Id!==e.settings.halfDayPresenceTypeId}))})))}},{key:"getHalfDayType",value:function(){return Object(D.a)(null)}},{key:"createFormGroup",value:function(){return this.fb.group({absenceTypeId:[null,Ce.p.required]})}},{key:"save",value:function(e){var n=this;this.saving$.next(!0),this.selectedLessonIds$.pipe(Object(C.a)(1),Object(v.a)((function(t){var c;return n.updateService.editLessonPresences(t,[Number(null===(c=n.storageService.getPayload())||void 0===c?void 0:c.id_person)],e)})),Object(Ie.a)((function(){return n.saving$.next(!1)}))).subscribe(this.onSaveSuccess.bind(this))}},{key:"onSaveSuccess",value:function(){this.toastr.success(this.translate.instant("my-absences.confirm.save-success")),this.navigateBack()}}]),e}()).\u0275fac=function(e){return new(e||he)(E.Kb(Ce.b),E.Kb(m.e),E.Kb(Le.b),E.Kb(J.d),E.Kb(Se.a),E.Kb(xe.a),E.Kb(S.a),E.Kb(x.b))},he.\u0275cmp=E.Eb({type:he,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,n){},encapsulation:2}),he),Te=function(e){return{count:e}};function Ee(e,n){if(1&e&&(E.Pb(0,"div",10),E.Ec(1),E.ec(2,"translate"),E.Ob()),2&e){var t=n.erzLet;E.xb(1),E.Gc(" ",E.gc(2,1,1===t?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",E.nc(4,Te,t))," ")}}function Me(e,n){if(1&e&&(E.Pb(0,"div",16),E.Ec(1),E.ec(2,"translate"),E.Ob()),2&e){var t=n.$implicit;E.xb(1),E.Gc(" ",E.gc(2,1,"global.validation-errors."+t.error,t.params)," ")}}function Ae(e,n){if(1&e&&(E.Nb(0),E.Cc(1,Me,3,4,"div",15),E.ec(2,"async"),E.Mb()),2&e){var t=E.dc(2);E.xb(1),E.jc("ngForOf",E.fc(2,1,t.absenceTypeIdErrors$))}}var Fe=function(e){return{"border-top pt-3":e}};function De(e,n){if(1&e&&(E.Pb(0,"div",11),E.Lb(1,"input",12),E.ec(2,"async"),E.Pb(3,"label",13),E.Ec(4),E.Ob(),E.Cc(5,Ae,3,3,"ng-container",14),E.ec(6,"async"),E.Ob()),2&e){var t,c=n.$implicit,r=n.index,i=E.dc();E.jc("ngClass",E.nc(12,Fe,c.IsHalfDay)),E.xb(1),E.Cb("is-invalid",E.fc(2,8,i.absenceTypeIdErrors$).length>0),E.jc("id","absence-type-"+r)("value",c.Id),E.xb(2),E.jc("for","absence-type-"+r),E.xb(1),E.Gc(" ",c.Designation," "),E.xb(1),E.jc("ngIf",(null==(t=E.fc(6,10,i.absenceTypes$))?null:t.length)-1===r)}}function _e(e,n){1&e&&(E.Pb(0,"div",17),E.Pb(1,"span",18),E.Ec(2,"Loading..."),E.Ob(),E.Ob())}var ze,Re,Ge,Ke,Ne,He=((ze=function(t){n(s,t);var r=c(s);function s(e,n,t,c,i,o,a,l,b,d){var f;return u(this,s),(f=r.call(this,e,n,t,c,i,o,a,l)).myAbsencesService=b,f.selectionService=d,f.selectedLessonIds$=f.selectionService.selectedIds$.pipe(Object(P.a)((function(e){return Object(G.a)(Q(e.map((function(e){return e.lessonIds}))))}))),f.confirmationStateId=f.settings.unconfirmedAbsencesRefreshTime,f}return d(s,[{key:"onSaveSuccess",value:function(){this.selectionService.clear(),this.myAbsencesService.reset(),e(i(s.prototype),"onSaveSuccess",this).call(this)}},{key:"navigateBack",value:function(){this.router.navigate(["/my-absences"])}}]),s}(we)).\u0275fac=function(e){return new(e||ze)(E.Kb(Ce.b),E.Kb(m.e),E.Kb(Le.b),E.Kb(J.d),E.Kb(Se.a),E.Kb(xe.a),E.Kb(S.a),E.Kb(x.a),E.Kb(M),E.Kb(_.a))},ze.\u0275cmp=E.Eb({type:ze,selectors:[["erz-my-absences-confirm"]],features:[E.ub],decls:24,vars:28,consts:[[1,"erz-container","erz-container-limited","erz-container-padding-y"],["class","mb-3 pb-3 border-bottom",4,"erzLet"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-3","border-bottom"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,n){1&e&&(E.Pb(0,"div",0),E.Cc(1,Ee,3,6,"div",1),E.ec(2,"async"),E.Pb(3,"form",2),E.bc("ngSubmit",(function(){return n.onSubmit()})),E.Pb(4,"div",3),E.Pb(5,"label"),E.Ec(6),E.ec(7,"translate"),E.Ob(),E.Cc(8,De,7,14,"div",4),E.ec(9,"async"),E.Ob(),E.Pb(10,"div",5),E.Ec(11),E.ec(12,"translate"),E.Ob(),E.Pb(13,"div",6),E.Pb(14,"button",7),E.bc("click",(function(){return n.cancel()})),E.ec(15,"async"),E.Ec(16),E.ec(17,"translate"),E.Ob(),E.Pb(18,"button",8),E.ec(19,"async"),E.Ec(20),E.ec(21,"translate"),E.Cc(22,_e,3,0,"div",9),E.ec(23,"async"),E.Ob(),E.Ob(),E.Ob(),E.Ob()),2&e&&(E.xb(1),E.jc("erzLet",E.fc(2,10,n.getSelectedCount())),E.xb(2),E.jc("formGroup",n.formGroup),E.xb(3),E.Gc("",E.fc(7,12,"my-absences.confirm.choose-presence-type"),":"),E.xb(2),E.jc("ngForOf",E.fc(9,14,n.absenceTypes$)),E.xb(3),E.Gc(" ",E.fc(12,16,"my-absences.confirm.remark")," "),E.xb(3),E.jc("disabled",E.fc(15,18,n.saving$)),E.xb(2),E.Gc(" ",E.fc(17,20,"my-absences.confirm.cancel")," "),E.xb(2),E.jc("disabled",E.fc(19,22,n.saving$)),E.xb(2),E.Gc(" ",E.fc(21,24,"my-absences.confirm.save")," "),E.xb(2),E.jc("ngIf",E.fc(23,26,n.saving$)))},directives:[q.a,Ce.r,Ce.i,Ce.d,ne.l,ne.m,ne.k,Ce.m,Ce.a,Ce.h,Ce.c],pipes:[ne.b,J.c],styles:[""],changeDetection:0}),ze),Xe=a("tk/3"),Be=a("sWYD"),Ue=a("Xep9"),Qe=a("9/EM"),qe=a("fhBx"),Ye=a("CqUA"),Je=((Re=function(e){n(r,e);var t=c(r);function r(e,n,c,i,s){var o;return u(this,r),(o=t.call(this,e,n,c,"/my-absences/report")).studentsService=i,o.storageService=s,o}return d(r,[{key:"getInitialFilter",value:function(){return{dateFrom:null,dateTo:null}}},{key:"isValidFilter",value:function(e){return Boolean(e.dateFrom||e.dateTo)}},{key:"loadEntries",value:function(e,n,t){var c=this,r=this.buildRequestParamsFromFilter(e).set("sort","From.asc").set("fields","Id,From,To,EventNumber,EventDesignation,EventManagerInformation");return this.loadingService.load(this.loadTimetableEntries(r).pipe(Object(v.a)((function(e){return Object(y.a)([Object(D.a)(e),c.loadLessonAbsences(e),c.loadLessonDispensations(e)])})),Object(P.a)((function(e){var n=o(e,3),t=n[0],r=n[1],i=n[2];return c.buildLessonPresences(t,r,i)})),Object(P.a)((function(e){return{offset:0,total:e.length,entries:e}}))),qe.a)}},{key:"buildParamsFromFilter",value:function(e){var n=e.dateFrom,t=e.dateTo,c={};return n&&(c.dateFrom=Object(Be.a)(n,"yyyy-MM-dd")),t&&(c.dateTo=Object(Be.a)(t,"yyyy-MM-dd")),c}},{key:"buildRequestParamsFromFilter",value:function(e){var n=new Xe.f;return e.dateFrom&&(n=n.set("filter.From",">"+Object(Be.a)(Object(Ue.a)(e.dateFrom,1),"yyyy-MM-dd"))),e.dateTo&&(n=n.set("filter.To","<"+Object(Be.a)(Object(Qe.a)(e.dateTo,1),"yyyy-MM-dd"))),n}},{key:"loadTimetableEntries",value:function(e){return this.studentsService.getTimetableEntries(this.studentId,e)}},{key:"loadLessonAbsences",value:function(e){return e.length>0?this.studentsService.getLessonAbsences(this.studentId,{"filter.Id":";"+e.map((function(e){return e.Id})).join(";")}):Object(D.a)([])}},{key:"loadLessonDispensations",value:function(e){return e.length>0?this.studentsService.getLessonDispensations(this.studentId,{"filter.Id":";"+e.map((function(e){return e.Id})).join(";")}):Object(D.a)([])}},{key:"buildLessonPresences",value:function(e,n,t){var c=this;return e.map((function(e){return c.buildLessonPresence(e,n,t)}))}},{key:"buildLessonPresence",value:function(e,n,t){var c,r,i,s=n.find((function(n){return n.LessonRef.Id===e.Id})),o=t.find((function(n){return n.LessonRef.Id===e.Id})),a=this.buildLessonPresenceTypeRef(s,o);return{Id:"",LessonRef:{Id:e.Id,HRef:null},StudentRef:(null===(c=s||o)||void 0===c?void 0:c.StudentRef)||{Id:this.studentId,HRef:null},EventRef:{Id:0,HRef:null},TypeRef:a,ConfirmationStateId:(null==s?void 0:s.ConfirmationStateId)||o&&this.settings.excusedAbsenceStateId||null,EventDesignation:e.EventDesignation||"",HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:e.From||new Date,LessonDateTimeTo:e.To||new Date,Comment:null,Date:e.From||new Date,Type:(null===(r=s||o)||void 0===r?void 0:r.Type)||null,StudentFullName:(null===(i=s||o)||void 0===i?void 0:i.StudentFullName)||"",StudyClassNumber:"",TeacherInformation:e.EventManagerInformation,WasAbsentInPrecedingLesson:!1}}},{key:"buildLessonPresenceTypeRef",value:function(e,n){return e?Object.assign({},e.TypeRef):n?Object.assign({},n.TypeRef):{Id:null,HRef:null}}},{key:"studentId",get:function(){var e,n=null===(e=this.storageService.getPayload())||void 0===e?void 0:e.id_person;if(null==n)throw new Error("No student id available");return n}}]),r}(qe.b)).\u0275fac=function(e){return new(e||Re)(E.Xb(ne.i),E.Xb(Ye.a),E.Xb(x.a),E.Xb($.a),E.Xb(S.a))},Re.\u0275prov=E.Gb({token:Re,factory:Re.\u0275fac}),Re),Ve=a("ulei"),We=((Ge=function(e){n(r,e);var t=c(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).selectedIds$=e.selection$.pipe(Object(P.a)(L.a)),e}return r}(Ve.a)).\u0275fac=function(e){return Ze(e||Ge)},Ge.\u0275prov=E.Gb({token:Ge,factory:Ge.\u0275fac}),Ge),Ze=E.Rb(We),en=((Ke=function(){function e(){u(this,e)}return d(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Ke)},Ke.\u0275cmp=E.Eb({type:Ke,selectors:[["erz-my-absences-report"]],features:[E.wb([Je,We])],decls:1,vars:0,template:function(e,n){1&e&&E.Lb(0,"router-outlet")},directives:[m.i],styles:[""],changeDetection:0}),Ke),nn=a("1G5W"),tn=a("KCaQ"),cn=a("vlqf"),rn=a("RYjX"),sn=a("yl8S"),on=a("M34a"),an=a("YDIV"),ln=a("DKSB"),un=function(){return["/my-absences"]},bn=((Ne=function(){function e(){u(this,e),this.filter={dateFrom:null,dateTo:null},this.filterChange=new E.n,this.minDate={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,day:(new Date).getDate()}}return d(e,[{key:"ngOnInit",value:function(){}},{key:"updateDateFrom",value:function(e){this.filter.dateFrom=e,e&&(this.filter.dateTo=e)}},{key:"show",value:function(){this.filterChange.emit({dateFrom:dn(this.filter.dateFrom),dateTo:dn(this.filter.dateTo)})}}]),e}()).\u0275fac=function(e){return new(e||Ne)},Ne.\u0275cmp=E.Eb({type:Ne,selectors:[["erz-my-absences-report-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[E.wb([{provide:Y.c,useClass:Y.d},{provide:Y.e,useClass:an.a}])],decls:22,vars:18,consts:[[1,"backlink"],[1,"btn","btn-link","py-2","text-body",3,"routerLink"],[1,"material-icons","d-block"],[1,"filters"],[1,"form-group"],[3,"minDate","value","valueChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(e,n){1&e&&(E.Pb(0,"div",0),E.Pb(1,"a",1),E.Pb(2,"i",2),E.Ec(3,"navigate_before"),E.Ob(),E.Ob(),E.Pb(4,"div"),E.Ec(5),E.ec(6,"translate"),E.Ob(),E.Ob(),E.Pb(7,"div",3),E.Pb(8,"div",4),E.Pb(9,"label"),E.Ec(10),E.ec(11,"translate"),E.Ob(),E.Pb(12,"erz-date-select",5),E.bc("valueChange",(function(e){return n.updateDateFrom(e)})),E.Ob(),E.Ob(),E.Pb(13,"div",4),E.Pb(14,"label"),E.Ec(15),E.ec(16,"translate"),E.Ob(),E.Pb(17,"erz-date-select",5),E.bc("valueChange",(function(e){return n.filter.dateTo=e})),E.Ob(),E.Ob(),E.Pb(18,"div",6),E.Pb(19,"button",7),E.bc("click",(function(){return n.show()})),E.Ec(20),E.ec(21,"translate"),E.Ob(),E.Ob(),E.Ob()),2&e&&(E.xb(1),E.jc("routerLink",E.mc(17,un)),E.xb(4),E.Fc(E.fc(6,9,"my-absences.report.title")),E.xb(5),E.Fc(E.fc(11,11,"my-absences.report.header.date-from")),E.xb(2),E.jc("minDate",n.minDate)("value",n.filter.dateFrom),E.xb(3),E.Fc(E.fc(16,13,"my-absences.report.header.date-to")),E.xb(2),E.jc("minDate",n.minDate)("value",n.filter.dateTo),E.xb(3),E.Gc(" ",E.fc(21,15,"my-absences.report.header.show")," "))},directives:[m.g,ln.a],pipes:[J.c],styles:["[_nghost-%COMP%]{display:block;padding:1.5rem;border-bottom:1px solid #dee2e6}.backlink[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1.5rem}.backlink[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-left:-1.5rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width:767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),Ne);function dn(e){return e?Object(on.a)(e):null}var fn=a("4Kj8"),pn=a("73sZ");function mn(e,n){if(1&e){var t=E.Qb();E.Pb(0,"div",12),E.Pb(1,"input",13,29),E.bc("change",(function(){E.uc(t);var e=E.dc(2).$implicit;return E.dc(6).selectionService.toggle(e)})),E.ec(3,"async"),E.Ob(),E.Ob()}if(2&e){var c=E.dc(2).$implicit,r=E.dc(6);E.xb(1),E.jc("checked",E.fc(3,1,r.selectionService.isSelected$(c)))}}function gn(e,n){if(1&e&&(E.Pb(0,"div"),E.Pb(1,"i",17),E.Ec(2),E.Ob(),E.Ob()),2&e){var t=E.dc().erzLet;E.Ab("checkbox presence-category ",t.category,""),E.xb(2),E.Fc(t.icon)}}function yn(e,n){if(1&e&&(E.Nb(0),E.Cc(1,mn,4,3,"div",27),E.Cc(2,gn,3,4,"ng-template",null,28,E.Dc),E.Mb()),2&e){var t=n.erzLet,c=E.tc(3);E.xb(1),E.jc("ngIf",!t)("ngIfElse",c)}}function vn(e,n){if(1&e&&(E.Nb(0),E.Ec(1),E.Mb()),2&e){var t=E.dc().$implicit;E.xb(1),E.Gc(", ",t.StudyClassNumber,"")}}function hn(e,n){if(1&e&&(E.Pb(0,"div",31),E.Ec(1),E.Ob()),2&e){var t=E.dc().erzLet;E.xb(1),E.Gc(" ",t," ")}}function On(e,n){if(1&e&&(E.Nb(0),E.Cc(1,hn,2,1,"div",30),E.Mb()),2&e){var t=n.erzLet;E.xb(1),E.jc("ngIf",t)}}function Pn(e,n){if(1&e){var t=E.Qb();E.Pb(0,"div",19,20),E.bc("click",(function(e){E.uc(t);var n=E.tc(1);return E.dc(6).onRowClick(e,n)})),E.Cc(2,yn,4,2,"ng-container",0),E.ec(3,"async"),E.Pb(4,"div",21),E.Ec(5),E.Cc(6,vn,2,1,"ng-container",8),E.Ob(),E.Pb(7,"div",22),E.Ec(8),E.ec(9,"date"),E.ec(10,"date"),E.Ob(),E.Pb(11,"div",23),E.Ec(12),E.Ob(),E.Cc(13,On,2,1,"ng-container",0),E.ec(14,"async"),E.Pb(15,"div",24),E.Ec(16),E.ec(17,"date"),E.Ob(),E.Pb(18,"div",25),E.Ec(19),E.ec(20,"erzDaysDifference"),E.Ob(),E.Pb(21,"div",26),E.Ec(22),E.ec(23,"date"),E.ec(24,"erzDaysDifference"),E.Ob(),E.Ob()}if(2&e){var c=n.$implicit,r=E.dc(6);E.xb(2),E.jc("erzLet",E.fc(3,11,r.getPresenceCategory(c))),E.xb(3),E.Gc(" ",c.EventDesignation,""),E.xb(1),E.jc("ngIf",c.StudyClassNumber),E.xb(2),E.Hc(" ",E.gc(9,13,c.LessonDateTimeFrom,"HH:mm"),"\u2013",E.gc(10,16,c.LessonDateTimeTo,"HH:mm")," "),E.xb(4),E.Gc(" ",c.TeacherInformation," "),E.xb(1),E.jc("erzLet",E.fc(14,19,r.getPresenceTypeDesignation(c))),E.xb(3),E.Gc(" ",E.gc(17,21,c.LessonDateTimeFrom,"dd.MM.yyyy")," "),E.xb(3),E.Gc(" ",E.fc(20,24,c.LessonDateTimeFrom)," "),E.xb(3),E.Hc(" ",E.gc(23,26,c.LessonDateTimeFrom,"dd.MM.yyyy"),", ",E.fc(24,29,c.LessonDateTimeFrom)," ")}}function Cn(e,n){if(1&e){var t=E.Qb();E.Pb(0,"div"),E.Pb(1,"div",10,11),E.bc("click",(function(e){E.uc(t);var n=E.tc(2);return E.dc(5).onRowClick(e,n)})),E.Pb(3,"div",12),E.Pb(4,"input",13),E.bc("change",(function(e){return E.uc(t),E.dc(5).toggleAll(e.target.checked)})),E.ec(5,"async"),E.Ob(),E.Ob(),E.Pb(6,"div",14),E.Ec(7),E.ec(8,"translate"),E.Ob(),E.Pb(9,"div",15),E.Pb(10,"a",16),E.ec(11,"async"),E.Pb(12,"i",17),E.Ec(13,"edit"),E.Ob(),E.Ob(),E.Ob(),E.Ob(),E.Cc(14,Pn,25,31,"div",18),E.Ob()}if(2&e){var c=E.dc(4).erzLet,r=E.dc();E.xb(4),E.jc("checked",E.fc(5,5,r.allSelected$)),E.xb(3),E.Gc(" ",E.fc(8,7,"my-absences.report.list.all")," "),E.xb(3),E.Cb("disabled",0===E.fc(11,9,r.selectionService.selection$).length),E.xb(4),E.jc("ngForOf",c.entries)}}function kn(e,n){1&e&&E.Lb(0,"erz-spinner",32)}function jn(e,n){if(1&e&&(E.Pb(0,"div",7),E.Cc(1,Cn,15,11,"div",8),E.Cc(2,kn,1,0,"erz-spinner",9),E.Ob()),2&e){var t=E.dc(3).erzLet;E.xb(1),E.jc("ngIf",t.entries&&t.entries.length>0),E.xb(1),E.jc("ngIf",t.loadingPage)}}function In(e,n){1&e&&(E.Pb(0,"p",33),E.Ec(1),E.ec(2,"translate"),E.Ob()),2&e&&(E.xb(1),E.Gc(" ",E.fc(2,1,"my-absences.report.no-entries")," "))}function xn(e,n){if(1&e&&(E.Nb(0),E.Cc(1,jn,3,2,"div",5),E.Cc(2,In,3,3,"ng-template",null,6,E.Dc),E.Mb()),2&e){var t=E.tc(3),c=E.dc(2).erzLet;E.xb(1),E.jc("ngIf",c.entries&&c.entries.length>0||c.loadingPage)("ngIfElse",t)}}function Sn(e,n){1&e&&E.Lb(0,"erz-spinner")}function $n(e,n){if(1&e&&(E.Nb(0),E.Cc(1,xn,4,2,"ng-container",2),E.ec(2,"async"),E.Cc(3,Sn,1,0,"ng-template",null,4,E.Dc),E.Mb()),2&e){var t=E.tc(4),c=E.dc(2);E.xb(1),E.jc("ngIf",!E.fc(2,2,c.state.loading$))("ngIfElse",t)}}function Ln(e,n){1&e&&(E.Pb(0,"p",33),E.Ec(1),E.ec(2,"translate"),E.Ob()),2&e&&(E.xb(1),E.Fc(E.fc(2,1,"my-absences.report.no-filter")))}function wn(e,n){if(1&e){var t=E.Qb();E.Nb(0),E.Pb(1,"erz-my-absences-report-header",1),E.bc("filterChange",(function(e){return E.uc(t),E.dc().state.setFilter(e)})),E.ec(2,"async"),E.Ob(),E.Cc(3,$n,5,4,"ng-container",2),E.ec(4,"async"),E.Cc(5,Ln,3,3,"ng-template",null,3,E.Dc),E.Mb()}if(2&e){var c=E.tc(6),r=E.dc();E.xb(1),E.jc("filter",E.fc(2,3,r.filterFromParams$)),E.xb(2),E.jc("ngIf",E.fc(4,5,r.state.isFilterValid$))("ngIfElse",c)}}var Tn=function(e,n,t){return{selection:e,entries:n,loadingPage:t}};function En(e){return{dateFrom:e.dateFrom?Object(tn.c)(e.dateFrom):null,dateTo:e.dateTo?Object(tn.c)(e.dateTo):null}}var Mn=function(e){return{count:e}};function An(e,n){if(1&e&&(E.Pb(0,"div",10),E.Ec(1),E.ec(2,"translate"),E.Ob()),2&e){var t=n.erzLet;E.xb(1),E.Gc(" ",E.gc(2,1,1===t?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",E.nc(4,Mn,t))," ")}}function Fn(e,n){if(1&e&&(E.Pb(0,"div",16),E.Ec(1),E.ec(2,"translate"),E.Ob()),2&e){var t=n.$implicit;E.xb(1),E.Gc(" ",E.gc(2,1,"global.validation-errors."+t.error,t.params)," ")}}function Dn(e,n){if(1&e&&(E.Nb(0),E.Cc(1,Fn,3,4,"div",15),E.ec(2,"async"),E.Mb()),2&e){var t=E.dc(2);E.xb(1),E.jc("ngForOf",E.fc(2,1,t.absenceTypeIdErrors$))}}var _n=function(e){return{"border-top pt-3":e}};function zn(e,n){if(1&e&&(E.Pb(0,"div",11),E.Lb(1,"input",12),E.ec(2,"async"),E.Pb(3,"label",13),E.Ec(4),E.Ob(),E.Cc(5,Dn,3,3,"ng-container",14),E.ec(6,"async"),E.Ob()),2&e){var t,c=n.$implicit,r=n.index,i=E.dc();E.jc("ngClass",E.nc(12,_n,c.IsHalfDay)),E.xb(1),E.Cb("is-invalid",E.fc(2,8,i.absenceTypeIdErrors$).length>0),E.jc("id","absence-type-"+r)("value",c.Id),E.xb(2),E.jc("for","absence-type-"+r),E.xb(1),E.Gc(" ",c.Designation," "),E.xb(1),E.jc("ngIf",(null==(t=E.fc(6,10,i.absenceTypes$))?null:t.length)-1===r)}}function Rn(e,n){1&e&&(E.Pb(0,"div",17),E.Pb(1,"span",18),E.Ec(2,"Loading..."),E.Ob(),E.Ob())}var Gn,Kn,Nn,Hn,Xn=[{path:"",component:A,children:[{path:"",component:Pe},{path:"confirm",component:He},{path:"report",component:en,children:[{path:"",component:(Kn=function(){function e(n,t,c,r,i,s){var a=this;u(this,e),this.state=n,this.selectionService=t,this.route=c,this.scrollPosition=r,this.presenceTypesService=i,this.settings=s,this.filterFromParams$=this.route.queryParams.pipe(Object(P.a)(En)),this.allSelected$=Object(y.a)([this.selectionService.selection$,this.state.entries$.pipe(Object(v.a)((function(e){return Object(y.a)(e.map((function(e){return a.getPresenceType(e)})))})))]).pipe(Object(P.a)((function(e){var n=o(e,2),t=n[0],c=n[1];return t.length>0&&t.length===c.filter(Object(w.d)(cn.c)).length}))),this.destroy$=new F.a}return d(e,[{key:"ngOnInit",value:function(){var e=this;this.filterFromParams$.pipe(Object(C.a)(1)).subscribe((function(n){return e.state.setFilter(n)})),this.state.validFilter$.pipe(Object(nn.a)(this.destroy$)).subscribe((function(){return e.selectionService.clear()}))}},{key:"ngAfterViewInit",value:function(){this.scrollPosition.restore()}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"getPresenceCategory",value:function(e){var n=this;return this.getPresenceType(e).pipe(Object(P.a)((function(t){return Object(cn.c)(t)?e.ConfirmationStateId===n.settings.checkableAbsenceStateId?{category:rn.a.Unapproved,icon:Object(rn.c)(rn.a.Unapproved)}:{category:rn.a.Absent,icon:Object(rn.c)(rn.a.Absent)}:null})))}},{key:"getPresenceTypeDesignation",value:function(e){return this.presenceTypesService.displayedTypes$.pipe(Object(P.a)((function(n){var t;return e.TypeRef.Id&&(null===(t=n.find((function(n){return n.Id===e.TypeRef.Id})))||void 0===t?void 0:t.Designation)||null})))}},{key:"toggleAll",value:function(e){var n=this;Object(y.a)([this.state.entries$.pipe(Object(C.a)(1)),this.presenceTypesService.presenceTypes$.pipe(Object(C.a)(1))]).subscribe((function(t){var c=o(t,2),r=c[0],i=c[1].filter((function(e){return Object(cn.c)(e)})).map((function(e){return e.Id}));n.selectionService.clear(e?r.filter((function(e){return null==e.TypeRef.Id||!i.includes(e.TypeRef.Id)})):null)}))}},{key:"onRowClick",value:function(e,n){var t=n.querySelector('input[type="checkbox"]');t&&e.target!==t&&!Boolean(e.target.closest(".buttons"))&&t.click()}},{key:"getPresenceType",value:function(e){return this.presenceTypesService.presenceTypes$.pipe(Object(P.a)((function(n){return e.TypeRef.Id&&n.find((function(n){return n.Id===e.TypeRef.Id}))||null})))}}]),e}(),Kn.\u0275fac=function(e){return new(e||Kn)(E.Kb(Je),E.Kb(We),E.Kb(m.a),E.Kb(sn.a),E.Kb(Se.a),E.Kb(x.a))},Kn.\u0275cmp=E.Eb({type:Kn,selectors:[["erz-my-absences-report-list"]],decls:4,vars:11,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3",4,"ngIf","ngIfElse"],["noEntries",""],[1,"p-3"],[4,"ngIf"],["class","inline",4,"ngIf"],[1,"entries-all",3,"click"],["all",""],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"checked","change"],[1,"all"],[1,"buttons"],["routerLink","confirm",1,"edit","btn","btn-primary","mr-2"],[1,"material-icons"],["class","entry",3,"click",4,"ngFor","ngForOf"],[1,"entry",3,"click"],["row",""],[1,"lesson-class"],[1,"time","pr-2"],[1,"teacher"],[1,"date"],[1,"days-ago"],[1,"date-days-ago"],["class","checkbox",4,"ngIf","ngIfElse"],["categoryIcon",""],["checkbox",""],["class","presence-type",4,"ngIf"],[1,"presence-type"],[1,"inline"],[1,"mt-3","px-3"]],template:function(e,n){1&e&&(E.Cc(0,wn,7,7,"ng-container",0),E.ec(1,"async"),E.ec(2,"async"),E.ec(3,"async")),2&e&&E.jc("erzLet",E.pc(7,Tn,E.fc(1,1,n.selectionService.selection$),E.fc(2,3,n.state.entries$),E.fc(3,5,n.state.loadingPage$)))},directives:[q.a,bn,ne.m,m.g,ne.l,fn.a],pipes:[ne.b,J.c,ne.e,pn.a],styles:['.entries-all[_ngcontent-%COMP%]{padding:0 0 .75rem 1.5rem;border-bottom:1px solid #e9ecef;display:-ms-grid;display:grid;grid-template-areas:"checkbox all buttons";-ms-grid-columns:-webkit-min-content 1fr -webkit-min-content;-ms-grid-columns:min-content 1fr min-content;grid-template-columns:-webkit-min-content 1fr -webkit-min-content;grid-template-columns:min-content 1fr min-content}.entries-all[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{-ms-grid-row-align:center;align-self:center}.entry[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #e9ecef;display:-ms-grid;display:grid;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";-ms-grid-columns:-webkit-min-content 2fr 1fr 2fr;-ms-grid-columns:min-content 2fr 1fr 2fr;grid-template-columns:-webkit-min-content 2fr 1fr 2fr;grid-template-columns:min-content 2fr 1fr 2fr}.entry[_ngcontent-%COMP%]:first-child{padding-top:0}.entries-all[_ngcontent-%COMP%] + .entry[_ngcontent-%COMP%]{padding-top:1.5rem}.presence-category.absent[_ngcontent-%COMP%]{color:#dc3545}.presence-category.unapproved[_ngcontent-%COMP%]{color:#ffa814}.checkbox[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:1;grid-area:checkbox;margin:0;padding:.6rem .75rem 0 0}.entry[_ngcontent-%COMP%] > .checkbox[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-row-span:2;-ms-grid-column:1}.presence-category[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{display:block;font-size:16px}.entries-all[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{padding-top:.2rem}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{-ms-grid-column:2;grid-area:all}.all[_ngcontent-%COMP%], .buttons[_ngcontent-%COMP%]{-ms-grid-row:1}.buttons[_ngcontent-%COMP%]{-ms-grid-column:3;grid-area:buttons;display:flex}.buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}.lesson-class[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2;grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:3;grid-area:time}.teacher[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:4;grid-area:teacher}.presence-type[_ngcontent-%COMP%]{-ms-grid-row:2;-ms-grid-column:2;color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{-ms-grid-row:2;-ms-grid-column:3;grid-area:date}.days-ago[_ngcontent-%COMP%]{-ms-grid-row:2;-ms-grid-column:4;color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width:750px){.entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";-ms-grid-columns:-webkit-min-content 1fr;-ms-grid-columns:min-content 1fr;grid-template-columns:-webkit-min-content 1fr;grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}.entry[_ngcontent-%COMP%] > .checkbox[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-row-span:5;-ms-grid-column:1}.lesson-class[_ngcontent-%COMP%]{-ms-grid-row:1;-ms-grid-column:2}.time[_ngcontent-%COMP%]{-ms-grid-row:4}.teacher[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{-ms-grid-column:2}.teacher[_ngcontent-%COMP%]{-ms-grid-row:2}.presence-type[_ngcontent-%COMP%]{-ms-grid-row:5;-ms-grid-column:2}.date-days-ago[_ngcontent-%COMP%]{-ms-grid-row:3;-ms-grid-column:2}}'],changeDetection:0}),Kn),data:{restoreScrollPositionFrom:["/my-absences/report/confirm"]}},{path:"confirm",component:(Gn=function(t){n(s,t);var r=c(s);function s(e,n,t,c,i,o,a,l,b,d){var f;return u(this,s),(f=r.call(this,e,n,t,c,i,o,a,l)).state=b,f.selectionService=d,f.selectedLessonIds$=f.selectionService.selectedIds$.pipe(Object(P.a)((function(e){return Object(G.a)(Q(e.map((function(e){return e.lessonIds}))))}))),f.confirmationStateId=f.settings.checkableAbsenceStateId,f}return d(s,[{key:"getHalfDayType",value:function(){return this.presenceTypesService.getPresenceType(this.settings.halfDayPresenceTypeId).pipe(Object(P.a)((function(e){return e.Active?e:null})))}},{key:"onSaveSuccess",value:function(){this.selectionService.clear(),this.state.resetEntries(),e(i(s.prototype),"onSaveSuccess",this).call(this)}},{key:"navigateBack",value:function(){var e=this;this.state.queryParams$.pipe(Object(C.a)(1)).subscribe((function(n){e.router.navigate(["/my-absences/report"],{queryParams:n})}))}}]),s}(we),Gn.\u0275fac=function(e){return new(e||Gn)(E.Kb(Ce.b),E.Kb(m.e),E.Kb(Le.b),E.Kb(J.d),E.Kb(Se.a),E.Kb(xe.a),E.Kb(S.a),E.Kb(x.a),E.Kb(Je),E.Kb(We))},Gn.\u0275cmp=E.Eb({type:Gn,selectors:[["erz-my-absences-confirm"]],features:[E.ub],decls:24,vars:28,consts:[[1,"erz-container","erz-container-limited","erz-container-padding-y"],["class","mb-3 pb-3 border-bottom",4,"erzLet"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-3","border-bottom"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,n){1&e&&(E.Pb(0,"div",0),E.Cc(1,An,3,6,"div",1),E.ec(2,"async"),E.Pb(3,"form",2),E.bc("ngSubmit",(function(){return n.onSubmit()})),E.Pb(4,"div",3),E.Pb(5,"label"),E.Ec(6),E.ec(7,"translate"),E.Ob(),E.Cc(8,zn,7,14,"div",4),E.ec(9,"async"),E.Ob(),E.Pb(10,"div",5),E.Ec(11),E.ec(12,"translate"),E.Ob(),E.Pb(13,"div",6),E.Pb(14,"button",7),E.bc("click",(function(){return n.cancel()})),E.ec(15,"async"),E.Ec(16),E.ec(17,"translate"),E.Ob(),E.Pb(18,"button",8),E.ec(19,"async"),E.Ec(20),E.ec(21,"translate"),E.Cc(22,Rn,3,0,"div",9),E.ec(23,"async"),E.Ob(),E.Ob(),E.Ob(),E.Ob()),2&e&&(E.xb(1),E.jc("erzLet",E.fc(2,10,n.getSelectedCount())),E.xb(2),E.jc("formGroup",n.formGroup),E.xb(3),E.Gc("",E.fc(7,12,"my-absences.confirm.choose-presence-type"),":"),E.xb(2),E.jc("ngForOf",E.fc(9,14,n.absenceTypes$)),E.xb(3),E.Gc(" ",E.fc(12,16,"my-absences.confirm.remark")," "),E.xb(3),E.jc("disabled",E.fc(15,18,n.saving$)),E.xb(2),E.Gc(" ",E.fc(17,20,"my-absences.confirm.cancel")," "),E.xb(2),E.jc("disabled",E.fc(19,22,n.saving$)),E.xb(2),E.Gc(" ",E.fc(21,24,"my-absences.confirm.save")," "),E.xb(2),E.jc("ngIf",E.fc(23,26,n.saving$)))},directives:[q.a,Ce.r,Ce.i,Ce.d,ne.l,ne.m,ne.k,Ce.m,Ce.a,Ce.h,Ce.c],pipes:[ne.b,J.c],styles:[""],changeDetection:0}),Gn)}]}]}],Bn=((Hn=function e(){u(this,e)}).\u0275mod=E.Ib({type:Hn}),Hn.\u0275inj=E.Hb({factory:function(e){return new(e||Hn)},imports:[[m.h.forChild(Xn)],m.h]}),Hn),Un=((Nn=function e(){u(this,e)}).\u0275mod=E.Ib({type:Nn}),Nn.\u0275inj=E.Hb({factory:function(e){return new(e||Nn)},imports:[[p.a,Bn]]}),Nn)}}])}();