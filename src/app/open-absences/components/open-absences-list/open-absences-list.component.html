<div
  class="erz-container"
  *erzLet="{
    selection: selectionService.selection$ | async,
    entries: openAbsencesService.filteredEntries$ | async,
    sortCriteria: openAbsencesService.sortCriteria$ | async
  } as data"
>
  <ng-container *ngIf="!(openAbsencesService.loading$ | async); else loading">
    <ng-container
      *ngIf="
        (openAbsencesService.sortedEntries$ | async).length > 0 ||
          data.entries.length > 0;
        else noEntries
      "
    >
      <div class="header pl-3 pr-3 pt-3">
        <div class="header-search input-group">
          <div class="input-group-prepend">
            <span class="input-group-text" id="search-addon"
              ><i class="material-icons">search</i></span
            >
          </div>
          <input
            type="text"
            class="form-control"
            [attr.placeholder]="'open-absences.search-by-name' | translate"
            [attr.aria-label]="'open-absences.search' | translate"
            aria-describedby="search-addon"
            (keyup)="openAbsencesService.search$.next($event.target.value)"
          />
        </div>
        <div class="d-flex align-items-center justify-content-between mt-1">
          <div class="selection-count pl-1">
            {{
              'open-absences.selected'
                | translate: { count: data.selection.length }
            }}
          </div>
          <a
            class="edit btn btn-link pr-1"
            [class.disabled]="data.selection.length === 0"
            routerLink="/open-absences/edit"
          >
            <i class="material-icons">edit</i>
          </a>
        </div>
      </div>

      <table class="table table-fixed">
        <thead>
          <tr>
            <th></th>
            <th
              *ngFor="let key of ['name', 'date']"
              (click)="openAbsencesService.toggleSort(key)"
            >
              {{ 'open-absences.list.header.' + key | translate }}
              <span class="sort-direction">{{
                getSortDirectionCharacter(data.sortCriteria, key)
              }}</span>
            </th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let entry of data.entries">
            <td (click)="onCheckboxCellClick($event, checkbox)">
              <input
                #checkbox
                type="checkbox"
                class="form-control"
                [checked]="selectionService.isSelected$(entry) | async"
                (change)="selectionService.toggle(entry)"
              />
            </td>
            <td>
              <a
                class="student-name"
                [routerLink]="['detail', entry.studentId, entry.dateString]"
                >{{ entry.studentFullName }}</a
              >
              <div class="lessons-count">
                {{
                  getLessonsCountKey(entry)
                    | translate: { count: entry.lessonsCount }
                }}
              </div>
            </td>
            <td>
              <div class="date">{{ entry.date | date: 'dd.MM.yyyy' }}</div>
              <div class="days-ago">
                {{
                  getDaysDifferenceKey(entry)
                    | translate: { count: entry.daysDifferenceAbsolute }
                }}
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-container>

    <ng-template #noEntries>
      <p class="mt-3">{{ 'open-absences.noEntries' | translate }}</p>
    </ng-template>
  </ng-container>

  <ng-template #loading>
    <erz-spinner></erz-spinner>
  </ng-template>
</div>
